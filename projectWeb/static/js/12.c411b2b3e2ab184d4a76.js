webpackJsonp([12],{DIIg:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n("HzJ8"),a=n.n(s),i=n("4YfN"),o=n.n(i),r=n("0eBz"),c=n("0DTB"),l=(n("sqAx"),n("NxGh"),n("IcnI"),n("yl8L")),u=n("SJI6"),h=n("EKaR"),d=n("fdFc"),m={name:"FillConsumable",components:{HeaderTop:r.a,FooterBottom:c.a,VanFieldSelectPicker:l.a},data:function(){return{toolShow:!1,searchValue:"",consumableMsgList:[],inventoryMsgList:[],temporaryInventoryMsgList:[]}},mounted:function(){var t=this;Object(d.b)()||(pushHistory(),this.gotoURL(function(){pushHistory(),t.$router.push({path:"workOrderDetails"}),t.changeTitleTxt({tit:"工单详情"}),Object(d.k)("currentTitle","工单详情")})),this.getMaterialById(this.taskId)},watch:{searchValue:{handler:function(t,e){console.log(t,e),this.inventoryMsgList=[],this.inventoryMsgList=this.temporaryInventoryMsgList.filter(function(e){return-1!=e.mateName.indexOf(t)})},deep:!0}},computed:o()({},Object(u.mapGetters)(["navTopTitle","repairsWorkOrderMsg","userInfo","completeRoomList","isCompleteRepairsWorkOrderPhotoList"]),{userName:function(){return this.userInfo.userName},userTypeId:function(){return this.userInfo.extendData.user_type_id},proId:function(){return this.userInfo.extendData.proId},proName:function(){return this.userInfo.extendData.proName},workerId:function(){return this.userInfo.extendData.userId},name:function(){return this.userInfo.name},taskId:function(){return this.repairsWorkOrderMsg.id}}),methods:o()({},Object(u.mapMutations)(["changeTitleTxt","changeCompleteRoomList","changeIsCompletePhotoList"]),{backTo:function(){this.$router.push({path:"workOrderDetails"}),this.changeTitleTxt({tit:"工单详情"}),Object(d.k)("currentTitle","工单详情")},getMaterialById:function(t){var e=this;Object(h.o)(t).then(function(t){t&&200==t.data.code&&t.data.data.length>0&&(e.consumableMsgList=[],e.consumableMsgList=t.data.data)}).catch(function(t){e.$dialog.alert({message:""+t.message,closeOnPopstate:!0}).then(function(){})})},getAllMaterial:function(t){var e=this;Object(h.j)(t).then(function(t){if(t&&200==t.data.code)if(t.data.data.length>0){e.inventoryMsgList=[],e.temporaryInventoryMsgList=[];var n=!0,s=!1,i=void 0;try{for(var o,r=a()(t.data.data);!(n=(o=r.next()).done);n=!0){o.value.checked=!1}}catch(t){s=!0,i=t}finally{try{!n&&r.return&&r.return()}finally{if(s)throw i}}e.inventoryMsgList=t.data.data,e.temporaryInventoryMsgList=t.data.data}else e.$dialog.alert({message:"没有查询到对应的物料信息",closeOnPopstate:!0}).then(function(){})}).catch(function(t){e.$dialog.alert({message:""+t.message,closeOnPopstate:!0}).then(function(){})})},mateNameEvent:function(t,e){this.inventoryMsgList[e].checked=!this.inventoryMsgList[e].checked},addConsumable:function(){this.toolShow=!0,this.getAllMaterial({proId:this.proId,state:0})},toolSure:function(){if(this.inventoryMsgList.some(function(t){return 1==t.checked})){var t=this.inventoryMsgList.filter(function(t){return 1==t.checked}),e=!0,n=!1,s=void 0;try{for(var i,o=a()(t);!(e=(i=o.next()).done);e=!0){var r=i.value;this.consumableMsgList.push({number:0,mateName:r.mateName,unit:r.unit,mateId:r.id})}}catch(t){n=!0,s=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw s}}}else this.$toast("至少要选择一种耗材")},deleteEvent:function(t,e){this.consumableMsgList.splice(e,1)},searchEvent:function(){var t=this;""!=this.searchValue?(this.inventoryMsgList=[],this.inventoryMsgList=this.temporaryInventoryMsgList.filter(function(e){return-1!=e.mateName.indexOf(t.searchValue)})):this.getAllMaterial({proId:this.proId,state:0})},toolCancel:function(){},sure:function(){var t=this,e={proId:this.proId,id:this.taskId,materials:[]},n=!0,s=!1,i=void 0;try{for(var o,r=a()(this.consumableMsgList);!(n=(o=r.next()).done);n=!0){var c=o.value;e.materials.push({proId:this.proId,proName:c.mateName,mateId:c.mateId,number:c.number})}}catch(t){s=!0,i=t}finally{try{!n&&r.return&&r.return()}finally{if(s)throw i}}Object(h.x)(e).then(function(e){e&&200==e.data.code?(t.$toast(""+e.data.msg),t.backTo()):t.$toast(""+e.data.msg)}).catch(function(e){t.$dialog.alert({message:""+e.message,closeOnPopstate:!0}).then(function(){})})},storageCompletedRoom:function(t){var e=this,n=[],s=[];if(n=deepClone(this.completeRoomList),this.completeRoomList.length>0){var a=this.completeRoomList.indexOf(this.completeRoomList.filter(function(t){return t.taskId==e.taskId})[0]);-1!=a?((s=n[a].officeList).push(t),n[a].officeList=Object(d.j)(s)):(s.push(t),n.push({officeList:Object(d.j)(s),taskId:this.taskId}))}else s.push(t),n.push({officeList:Object(d.j)(s),taskId:this.taskId});this.changeCompleteRoomList(n),Object(d.k)("completeRoomList",{sweepCodeInfo:n})}})},f={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"content-wrapper"},[n("div",{staticClass:"worker-show"},[n("HeaderTop",{attrs:{title:t.navTopTitle}},[n("van-icon",{attrs:{slot:"left",name:"arrow-left"},on:{click:t.backTo},slot:"left"})],1),t._v(" "),n("div",{staticClass:"content-top"},[t._m(0),t._v(" "),n("div",{staticClass:"circulation-area"},t._l(t.consumableMsgList,function(e,s){return n("p",{key:e+"-"+s},[n("span",[t._v(t._s(s+1))]),t._v(" "),n("span",[t._v("\n            "+t._s(e.mateName)+"\n          ")]),t._v(" "),n("span",[t._v("\n            "+t._s(e.unit)+"\n          ")]),t._v(" "),n("span",[n("van-stepper",{attrs:{theme:"round",min:"0"},on:{change:t.stepperEvent},model:{value:e.number,callback:function(n){t.$set(e,"number",n)},expression:"item.number"}})],1)])}),0)]),t._v(" "),n("div",{staticClass:"content-bottom"},[n("p",{staticClass:"back-home",on:{click:t.addConsumable}},[t._v("添加物资")]),t._v(" "),n("p",{staticClass:"quit-account",on:{click:t.sure}},[t._v("确认")])])],1),t._v(" "),n("van-dialog",{attrs:{"show-cancel-button":"",width:"92%",confirmButtonText:"添加"},on:{confirm:t.toolSure,cancel:t.toolCancel},model:{value:t.toolShow,callback:function(e){t.toolShow=e},expression:"toolShow"}},[n("div",{staticClass:"tool-name-list"},[n("div",{staticClass:"tool-name-list-title-innner"},[n("van-field",{model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}}),t._v(" "),n("span",{staticClass:"icon-span"},[n("van-icon",{attrs:{name:"search"},on:{click:t.searchEvent}})],1)],1),t._v(" "),n("div",{staticClass:"tool-name-list-content"},[n("p",{staticClass:"circulation-area-title"},[n("span",[t._v("物质名称")]),t._v(" "),n("span",[t._v("单位")]),t._v(" "),n("span")]),t._v(" "),t._l(t.inventoryMsgList,function(e,s){return n("p",{key:e+"-"+s,staticClass:"circulation-area-content"},[n("span",{on:{click:function(n){return t.mateNameEvent(e,s)}}},[t._v("\n                "+t._s(e.mateName)+"\n              ")]),t._v(" "),n("span",[t._v("\n                "+t._s(e.unit)+"\n              ")]),t._v(" "),n("span",[n("van-checkbox",{attrs:{shape:"square"},model:{value:e.checked,callback:function(n){t.$set(e,"checked",n)},expression:"item.checked"}})],1)])})],2)])])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"circulation-area-title"},[e("span"),this._v(" "),e("span",[this._v("耗材名称")]),this._v(" "),e("span",[this._v("单位")]),this._v(" "),e("span",[this._v("数量")])])}]};var p=n("C7Lr")(m,f,!1,function(t){n("S/Oo")},"data-v-4f863128",null);e.default=p.exports},"S/Oo":function(t,e){}});