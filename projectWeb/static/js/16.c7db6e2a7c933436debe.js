webpackJsonp([16],{CAjW:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("HzJ8"),s=r.n(i),n=r("4YfN"),c=r.n(n),a=r("0eBz"),o=r("0DTB"),h=(r("sqAx"),r("NxGh"),r("IcnI"),r("yl8L")),m=r("SJI6"),l=r("fdFc"),u=r("EKaR"),d={name:"DepartmentServiceBill",components:{HeaderTop:a.a,FooterBottom:o.a,VanFieldSelectPicker:h.a},data:function(){return{issueShow:!1,isBackShow:!1,showFillConsumable:!1,currentDepartmentId:"",currentDepartmentName:"",consumableMsgList:[]}},mounted:function(){var e=this;Object(l.b)()||(pushHistory(),this.gotoURL(function(){pushHistory(),e.issueShow=!1,e.isBackShow=!0,e.isBackShow?e.isBackShow=!0:(e.$router.push({path:"departmentWorkOrderDeatils"}),e.changeTitleTxt({tit:"工单详情"}),Object(l.k)("currentTitle","工程详情"))})),this.echoCurrentDepartmentId(),this.getExamineItems({proId:this.proId,depId:this.currentDepartmentId})},activated:function(){var e=this;this.issueShow=!1,Object(l.b)()||(pushHistory(),this.gotoURL(function(){pushHistory(),e.issueShow=!1,e.isBackShow=!0,e.isBackShow?e.isBackShow=!0:(e.$router.push({path:"departmentWorkOrderDeatils"}),e.changeTitleTxt({tit:"工单详情"}),Object(l.k)("currentTitle","工程详情"))})),this.echoCurrentDepartmentId(),this.getExamineItems({proId:this.proId,depId:this.currentDepartmentId})},watch:{},computed:c()({},Object(m.mapGetters)(["navTopTitle","catch_components","departmentServiceMsg","userInfo","isCurrentDepartmentServiceVerifySweepCode","departmentServiceOfficeId","completeDepartmentServiceOfficeInfo","completeDepartmentServiceCheckedItemList","currentDepartmentServiceCheckedItemId"]),{userName:function(){return this.userInfo.userName},userTypeId:function(){return this.userInfo.extendData.user_type_id},proId:function(){return this.userInfo.extendData.proId},proName:function(){return this.userInfo.extendData.proName},workerId:function(){return this.userInfo.extendData.userId},name:function(){return this.userInfo.name},taskId:function(){return this.departmentServiceMsg.id}}),methods:c()({},Object(m.mapMutations)(["changeTitleTxt","changeCatchComponent","changeCompleteDepartmentServiceOfficeInfo","changeCurrentDepartmentServiceCheckedItemId","changeCompleteDepartmentServiceCheckedItemList","changeIsSingleDepartmentSignature"]),{backTo:function(){this.issueShow=!1,this.isBackShow=!0,this.isBackShow?this.isBackShow=!0:(this.$router.push({path:"departmentWorkOrderDeatils"}),this.changeTitleTxt({tit:"工单详情"}),Object(l.k)("currentTitle","工程详情"))},isBackSure:function(){this.clearCheckedInfo(),this.$router.push({path:"departmentWorkOrderDeatils"}),this.changeTitleTxt({tit:"工单详情"}),Object(l.k)("currentTitle","工程详情")},isBackCancel:function(){this.isBackShow=!1},echoCurrentDepartmentId:function(){var e=this;try{if(0==this.isCurrentDepartmentServiceVerifySweepCode.length)return;var t=this.isCurrentDepartmentServiceVerifySweepCode.indexOf(this.isCurrentDepartmentServiceVerifySweepCode.filter(function(t){return t.taskId==e.taskId})[0]);if(-1==t)return;this.currentDepartmentId=this.isCurrentDepartmentServiceVerifySweepCode[t].number,this.currentDepartmentName=Object(l.a)(JSON.parse(Object(l.h)("departmentMessage")),this.currentDepartmentId)}catch(e){this.$toast(""+e)}},fillConsumable:function(){this.$router.push({path:"departmentServiceFillConsumable"}),this.changeTitleTxt({tit:"填写耗材"}),Object(l.k)("currentTitle","填写耗材")},getExamineItems:function(e){var t=this;Object(u.n)(e).then(function(e){if(e&&200==e.data.code)if(t.consumableMsgList=[],e.data.data.length>0){var r=!0,i=!1,n=void 0;try{for(var c,a=s()(e.data.data);!(r=(c=a.next()).done);r=!0){var o=c.value;t.consumableMsgList.push({depId:o.depId,depName:o.depName,typeName:o.typeName,itemName:o.itemName,itemId:o.itemId,right:!1,error:!1,rightClicked:!1,errorClicked:!1,checkResult:0})}}catch(e){i=!0,n=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw n}}if(t.completeDepartmentServiceCheckedItemList.length>0){var h=t.completeDepartmentServiceCheckedItemList.indexOf(t.completeDepartmentServiceCheckedItemList.filter(function(e){return e.taskId==t.taskId})[0]);if(-1==h)return;if(t.completeDepartmentServiceCheckedItemList[h].depId!=t.currentDepartmentId)return void t.clearCheckedInfo();if(t.consumableMsgList.length>0)for(var m=0,l=t.consumableMsgList.length;m<l;m++)if(t.completeDepartmentServiceCheckedItemList[h].officeList.length>0)for(var u=0,d=t.completeDepartmentServiceCheckedItemList[h].officeList.length;u<d;u++)t.consumableMsgList[m].itemId==t.completeDepartmentServiceCheckedItemList[h].officeList[u].id&&("error"==t.completeDepartmentServiceCheckedItemList[h].officeList[u].type?(t.consumableMsgList[m].errorClicked=!0,t.consumableMsgList[m].rightClicked=!1,t.consumableMsgList[m].right=!1,t.consumableMsgList[m].error=!0,t.consumableMsgList[m].checkResult=t.completeDepartmentServiceCheckedItemList[h].officeList[u].checkResult):(t.consumableMsgList[m].errorClicked=!1,t.consumableMsgList[m].rightClicked=!0,t.consumableMsgList[m].right=!0,t.consumableMsgList[m].error=!1,t.consumableMsgList[m].checkResult=0))}console.log("变",t.consumableMsgList)}else t.$dialog.alert({message:"没有查询到检查项",closeOnPopstate:!0}).then(function(){});else t.$dialog.alert({message:""+e.data.msg,closeOnPopstate:!0}).then(function(){})}).catch(function(e){t.$dialog.alert({message:""+e.message,closeOnPopstate:!0}).then(function(){})})},storageCompleteCheckItemInfo:function(e){var t=this,r=[],i=[];if(r=Object(l.e)(this.completeDepartmentServiceCheckedItemList),this.completeDepartmentServiceCheckedItemList.length>0){var s=this.completeDepartmentServiceCheckedItemList.indexOf(this.completeDepartmentServiceCheckedItemList.filter(function(e){return e.taskId==t.taskId})[0]);if(-1!=s){i=r[s].officeList;var n=this.currentDepartmentServiceCheckedItemId;i=i.filter(function(e){return e.id!==t.currentDepartmentServiceCheckedItemId.id}),n.checkResult=e,this.changeCurrentDepartmentServiceCheckedItemId(n),i.push(this.currentDepartmentServiceCheckedItemId),r[s].officeList=Object(l.j)(i),r[s].depId=this.currentDepartmentId}else{var c=this.currentDepartmentServiceCheckedItemId;c.checkResult=e,this.changeCurrentDepartmentServiceCheckedItemId(c),i.push(this.currentDepartmentServiceCheckedItemId),r.push({officeList:Object(l.j)(i),taskId:this.taskId,depId:this.currentDepartmentId})}}else{var a=this.currentDepartmentServiceCheckedItemId;a.checkResult=e,this.changeCurrentDepartmentServiceCheckedItemId(a),i.push(this.currentDepartmentServiceCheckedItemId),r.push({officeList:Object(l.j)(i),taskId:this.taskId,depId:this.currentDepartmentId})}this.changeCompleteDepartmentServiceCheckedItemList(r),Object(l.k)("isCompleteDepartmentServiceCheckedItemList",{sweepCodeInfo:r})},rightClick:function(e,t,r){e.errorClicked?this.$toast("检查结果已上报,不能更改"):("right"==r?(this.changeCurrentDepartmentServiceCheckedItemId({id:e.itemId,type:"right"}),Object(l.k)("checkedItemId",{id:e.itemId,type:"right"}),this.storageCompleteCheckItemInfo(0),this.consumableMsgList[t].right=!this.consumableMsgList[t].right,1==this.consumableMsgList[t].error&&(this.consumableMsgList[t].error=!1)):(this.changeCurrentDepartmentServiceCheckedItemId({id:e.itemId,type:"error"}),Object(l.k)("checkedItemId",{id:e.itemId,type:"error"}),this.consumableMsgList[t].error=!this.consumableMsgList[t].error,1==this.consumableMsgList[t].right&&(this.consumableMsgList[t].right=!1),this.issueShow=!0),this.showFillConsumable=!1,this.getExamineItems({proId:this.proId,depId:this.currentDepartmentId}),console.log(this.consumableMsgList))},reportProblem:function(){this.$router.push({path:"departmentServiceIssueReport"}),this.changeTitleTxt({tit:"巡检问题上报"}),Object(l.k)("currentTitle","巡检问题上报")},noReportProblem:function(){this.storageCompleteCheckItemInfo(1),this.showFillConsumable=!0,this.getExamineItems({proId:this.proId,depId:this.currentDepartmentId})},storeCompleteDepartmentNumber:function(){var e=this,t=[],r=[];if(t=Object(l.e)(this.completeDepartmentServiceOfficeInfo),this.completeDepartmentServiceOfficeInfo.length>0){var i=this.completeDepartmentServiceOfficeInfo.indexOf(this.completeDepartmentServiceOfficeInfo.filter(function(t){return t.taskId==e.taskId})[0]);-1!=i?((r=t[i].officeList).push(this.departmentServiceOfficeId),t[i].officeList=Object(l.j)(r)):(r.push(this.departmentServiceOfficeId),t.push({officeList:Object(l.j)(r),taskId:this.taskId}))}else r.push(this.departmentServiceOfficeId),t.push({officeList:Object(l.j)(r),taskId:this.taskId});this.changeCompleteDepartmentServiceOfficeInfo(t),Object(l.k)("isCompleteDepartmentServiceOfficeInfo",{sweepCodeInfo:t})},clearCheckedInfo:function(){var e=this,t=this.completeDepartmentServiceCheckedItemList.filter(function(t){return t.taskId!==e.taskId});this.changeCompleteDepartmentServiceCheckedItemList(t),Object(l.k)("isCompleteDepartmentServiceCheckedItemList",{sweepCodeInfo:t})},sure:function(){var e=this;if(this.consumableMsgList.every(function(e){return 1==e.rightClicked||1==e.errorClicked})){var t=[],r=!0,i=!1,n=void 0;try{for(var c,a=s()(this.consumableMsgList);!(r=(c=a.next()).done);r=!0){var o=c.value;t.push({itemId:o.itemId,itemName:o.itemName,checkResult:o.checkResult})}}catch(e){i=!0,n=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw n}}var h={taskId:this.taskId,depId:this.currentDepartmentId,checkItems:t};Object(u.h)(h).then(function(t){t&&200==t.data.code?(e.changeIsSingleDepartmentSignature(!0),e.$router.push({path:"departmentServiceSignature"}),e.changeTitleTxt({tit:"巡检签名"}),Object(l.k)("currentTitle","巡检签名"),e.$toast("上报成功"),e.clearCheckedInfo(),e.storeCompleteDepartmentNumber()):e.$toast(""+t.data.msg)}).catch(function(t){e.$dialog.alert({message:""+t.message,closeOnPopstate:!0}).then(function(){})})}else this.$toast("请完成所有的检查项")}})},p={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"content-wrapper"},[r("div",{staticClass:"worker-show"},[r("HeaderTop",{attrs:{title:e.navTopTitle}},[r("van-icon",{attrs:{slot:"left",name:"arrow-left"},on:{click:e.backTo},slot:"left"})],1),e._v(" "),r("div",{staticClass:"content-top"},[r("div",{staticClass:"circulation-area-title"},[e._v("\n        当前巡检科室: "+e._s(e.currentDepartmentName)+"\n      ")]),e._v(" "),r("div",{staticClass:"circulation-area"},e._l(e.consumableMsgList,function(t,i){return r("p",{key:t+"-"+i},[r("span",[e._v(e._s(i+1))]),e._v(" "),r("span",[e._v("\n            "+e._s(t.itemName)+"\n          ")]),e._v(" "),r("span",[r("van-icon",{class:{styleRight:t.right||t.rightClicked},attrs:{name:"checked"},on:{click:function(r){return e.rightClick(t,i,"right")}}}),e._v(" "),r("van-icon",{class:{styleError:t.error||t.errorClicked},attrs:{name:"clear"},on:{click:function(r){return e.rightClick(t,i,"error")}}})],1)])}),0)]),e._v(" "),r("div",{staticClass:"content-bottom"},[r("p",{directives:[{name:"show",rawName:"v-show",value:e.showFillConsumable,expression:"showFillConsumable"}],staticClass:"back-home",on:{click:e.fillConsumable}},[e._v("填写耗材")]),e._v(" "),r("p",{staticClass:"quit-account",on:{click:e.sure}},[e._v("确认")])])],1),e._v(" "),r("van-dialog",{attrs:{title:"是否反馈该问题到调度中心","show-cancel-button":"","close-on-click-overlay":!0,"confirm-button-text":"不上报","cancel-button-text":"上报问题"},on:{confirm:e.noReportProblem,cancel:e.reportProblem},model:{value:e.issueShow,callback:function(t){e.issueShow=t},expression:"issueShow"}}),e._v(" "),r("van-dialog",{attrs:{title:"返回上级将不会保存本科室检查结果,确定返回?","show-cancel-button":""},on:{confirm:e.isBackSure,cancel:e.isBackCancel},model:{value:e.isBackShow,callback:function(t){e.isBackShow=t},expression:"isBackShow"}})],1)},staticRenderFns:[]};var f=r("C7Lr")(d,p,!1,function(e){r("ie7k")},"data-v-3c77b484",null);t.default=f.exports},ie7k:function(e,t){}});