webpackJsonp([10],{PPsl:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("HzJ8"),n=s.n(a),r=s("4YfN"),i=s.n(r),o=s("0eBz"),c=s("0DTB"),l=s("sqAx"),h=s("NxGh"),d=s("SJI6"),p=s("IcnI"),u=s("fdFc"),v=s("EKaR"),m={name:"RepairsWorkOrder",data:function(){return{currentIndex:0,taskId:"",tabTitleList:["待办任务","已完成"],reasonShow:!1,isRefresh:!1,noDataShow:!1,showLoadingHint:!1,reasonOperationList:[],reasonIndex:"",reasonText:"",reasonName:"",reasonValue:"",taskMessageList:[],taskCompleteMessageList:[]}},components:{HeaderTop:o.a,NoData:l.a,Loading:h.a,FooterBottom:c.a},computed:i()({},Object(d.mapGetters)(["navTopTitle","userInfo","catch_components","isFreshRepairsWorkOrderPage"]),{proId:function(){return this.userInfo.extendData.proId},workerId:function(){return JSON.parse(Object(u.h)("userInfo")).extendData.userId}}),watch:{},beforeRouteEnter:function(t,e,s){var a=p.a.state.catchComponent.catch_components;-1===a.indexOf("RepairsWorkOrder")&&a.push("RepairsWorkOrder"),s()},beforeRouteLeave:function(t,e,s){var a=this.catch_components;"workOrderDetails"!==t.name&&(a.indexOf("RepairsWorkOrder")>-1&&this.changeCatchComponent([]));s()},mounted:function(){var t=this;if(!Object(u.b)()){pushHistory(),this.gotoURL(function(){pushHistory(),t.$router.push({path:"home"}),t.changeTitleTxt({tit:"工程管理系统"}),Object(u.k)("currentTitle","工程管理系统")})}this.isFreshRepairsWorkOrderPage&&this.getRepairsProjectList({proId:this.proId,workerId:this.workerId,state:-1,startDate:"",endDate:""},0)},activated:function(){var t=this;if(!Object(u.b)()){pushHistory(),this.gotoURL(function(){pushHistory(),t.$router.push({path:"home"}),t.changeTitleTxt({tit:"工程管理系统"}),Object(u.k)("currentTitle","工程管理系统")})}this.isFreshRepairsWorkOrderPage&&this.getRepairsProjectList({proId:this.proId,workerId:this.workerId,state:-1,startDate:"",endDate:""},0)},methods:i()({},Object(d.mapMutations)(["changeTitleTxt","changeCatchComponent","changeRepairsWorkOrderMsg"]),{stateTransfer:function(t){switch(t){case 0:return"未分配";case 1:return"待确认";case 2:return"待完成";case 3:return"进行中";case 4:return"待签字";case 5:return"已完成";case 6:return"已取消";case 7:return"已延迟"}},onRefresh:function(){this.getRepairsProjectList({proId:this.proId,workerId:this.workerId,state:0==this.currentIndex?-1:-2,startDate:"",endDate:""},this.currentIndex)},reasonSure:function(){var t=this;""!==this.reasonIndex?Object(v.a)({proId:this.proId,taskId:this.taskId,reason:this.reasonText}).then(function(e){e&&200==e.data.code?(t.$toast(""+e.data.msg),t.getRepairsProjectList({proId:t.proId,workerId:t.workerId,state:-1,startDate:"",endDate:""},0)):t.$toast(""+e.data.msg)}).catch(function(e){t.$dialog.alert({message:""+e.message,closeOnPopstate:!0}).then(function(){})}):this.$toast("请选择退回原因")},reasonCancel:function(){this.reasonIndex="",this.reasonName="",this.reasonShow=!1},reasonCheck:function(t,e){this.reasonIndex=e,this.reasonText=t.text,this.reasonName=t.text,this.reasonValue=t.value},liClickEvent:function(t,e){this.currentIndex=e,0==e?this.getRepairsProjectList({proId:this.proId,workerId:this.workerId,state:-1,startDate:"",endDate:""},e):this.getRepairsProjectList({proId:this.proId,workerId:this.workerId,state:-2,startDate:"",endDate:""},e)},getRepairsProjectList:function(t,e){var s=this;this.noDataShow=!1,this.showLoadingHint=!0,Object(v.s)(t).then(function(t){if(s.showLoadingHint=!1,s.taskMessageList=[],s.taskCompleteMessageList=[],t&&200==t.data.code)if(s.isRefresh=!1,t.data.data.length>0){s.noDataShow=!1;var a=!0,r=!1,i=void 0;try{for(var o,c=n()(t.data.data);!(a=(o=c.next()).done);a=!0){var l=o.value;0==e?s.taskMessageList.push({taskNumber:l.taskNumber,taskDesc:l.taskDesc,typeName:l.typeName,depName:l.depName,planStartTime:l.planStartTime,planFinishTime:l.planFinishTime,createTime:l.createTime,state:l.state,id:l.id,isMe:l.isMe,spaces:l.spaces}):s.taskCompleteMessageList.push({taskNumber:l.taskNumber,taskDesc:l.taskDesc,typeName:l.typeName,depName:l.depName,planStartTime:l.planStartTime,planFinishTime:l.planFinishTime,createTime:l.createTime,state:l.state,id:l.id,isMe:l.isMe,spaces:l.spaces})}}catch(t){r=!0,i=t}finally{try{!a&&c.return&&c.return()}finally{if(r)throw i}}var h=!0,d=!1,p=void 0;try{for(var u,v=n()(s.taskMessageList);!(h=(u=v.next()).done);h=!0){var m=u.value;for(var k in m)if("spaces"==k){var f=!0,w=!1,_=void 0;try{for(var C,I=n()(m[k]);!(f=(C=I.next()).done);f=!0){C.value.check=!1}}catch(t){w=!0,_=t}finally{try{!f&&I.return&&I.return()}finally{if(w)throw _}}}}}catch(t){d=!0,p=t}finally{try{!h&&v.return&&v.return()}finally{if(d)throw p}}}else s.noDataShow=!0}).catch(function(t){s.$dialog.alert({message:""+t.message,closeOnPopstate:!0}).then(function(){}),s.noDataShow=!0,s.showLoadingHint=!1})},taskBack:function(t){var e=this;this.taskId=t.id,this.reasonShow=!0,Object(v.k)({proId:this.proId}).then(function(t){if(e.reasonOperationList=[],t&&200==t.data.code)if(t.data.data.length>0){var s=!0,a=!1,r=void 0;try{for(var i,o=n()(t.data.data);!(s=(i=o.next()).done);s=!0){var c=i.value;e.reasonOperationList.push({text:c.name,value:c.code})}}catch(t){a=!0,r=t}finally{try{!s&&o.return&&o.return()}finally{if(a)throw r}}}else e.$toast("没有查到退回原因")}).catch(function(t){e.$dialog.alert({message:""+t.message,closeOnPopstate:!0}).then(function(){})}),this.reasonIndex=""},taskSure:function(t){var e=this;Object(v.B)({proId:this.proId,taskId:t.id,workerId:this.workerId}).then(function(t){t&&200==t.data.code?e.getRepairsProjectList({proId:e.proId,workerId:e.workerId,state:-1,startDate:"",endDate:""},0):e.$dialog.alert({message:""+t.data.msg,closeOnPopstate:!0}).then(function(){})}).catch(function(t){e.$dialog.alert({message:""+t.message,closeOnPopstate:!0}).then(function(){})})},taskView:function(t){this.changeRepairsWorkOrderMsg(t),Object(u.k)("repairsWorkOrderMsg",t),this.$router.push({path:"workOrderDetails"}),this.changeTitleTxt({tit:"工单详情"}),Object(u.k)("currentTitle","工单详情")},backTo:function(){this.$router.push({path:"home"}),this.changeTitleTxt({tit:"工程管理系统"}),Object(u.k)("currentTitle","工程管理系统")}})},k={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content-wrapper"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.noDataShow,expression:"noDataShow"}],staticClass:"no-data"},[s("NoData")],1),t._v(" "),s("div",{staticClass:"loading"},[s("loading",{attrs:{isShow:t.showLoadingHint,textContent:"加载中,请稍候····",textColor:"#2db8f9"}})],1),t._v(" "),s("HeaderTop",{attrs:{title:t.navTopTitle}},[s("van-icon",{attrs:{slot:"left",name:"arrow-left"},on:{click:t.backTo},slot:"left"})],1),t._v(" "),s("div",{staticClass:"content-top"},[s("ul",{staticClass:"tab-title"},t._l(t.tabTitleList,function(e,a){return s("li",{key:""+a,class:{liStyle:t.currentIndex==a},on:{click:function(s){return t.liClickEvent(e,a)}}},[t._v(t._s(e))])}),0)]),t._v(" "),s("div",{staticClass:"content-bottom"},[s("van-pull-refresh",{attrs:{"success-text":"刷新成功"},on:{refresh:t.onRefresh},model:{value:t.isRefresh,callback:function(e){t.isRefresh=e},expression:"isRefresh"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:0===t.currentIndex,expression:"currentIndex === 0"}],staticClass:"content-list-action-task-wrapper"},t._l(t.taskMessageList,function(e,a){return s("div",{key:a+"-"+e,staticClass:"content-list-action-task-item"},[s("span",{staticClass:"status-box",class:{statusWaitSure:1==e.state,statusWaitFinish:3==e.state,statusWaitSignature:4==e.state}},[t._v(t._s(t.stateTransfer(e.state)))]),t._v(" "),s("span",{staticClass:"task-date"},[t._v(t._s(e.planStartTime))]),t._v(" "),s("p",{staticClass:"task-btn"},[s("span",{directives:[{name:"show",rawName:"v-show",value:1==e.state||2==e.state,expression:"item.state == 1 || item.state == 2"}],staticClass:"back",on:{click:function(s){return t.taskBack(e)}}},[t._v("退回")]),t._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:1==e.state,expression:"item.state == 1"}],staticClass:"sure",on:{click:function(s){return t.taskSure(e)}}},[t._v("确认")]),t._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:1!==e.state,expression:"item.state !== 1"}],staticClass:"view",on:{click:function(s){return t.taskView(e)}}},[t._v("查看任务")])]),t._v(" "),s("p",{staticClass:"work-order-number"},[s("span",{staticClass:"tit"},[t._v("工单号:")]),t._v(" "),s("span",{staticClass:"name"},[t._v(t._s(e.taskNumber))])]),t._v(" "),s("p",{staticClass:"work-info-other"},[s("span",{staticClass:"tit"},[t._v("工单:")]),t._v(" "),s("span",{staticClass:"name"},[t._v(t._s(e.taskDesc))])]),t._v(" "),s("p",{staticClass:"work-info-other"},[s("span",{staticClass:"tit"},[t._v("类型:")]),t._v(" "),s("span",{staticClass:"name"},[t._v(t._s(e.typeName))])]),t._v(" "),s("p",{staticClass:"work-info-other"},[s("span",{staticClass:"tit"},[t._v("地点:")]),t._v(" "),s("span",{staticClass:"name"},[t._v(t._s(e.depName))]),t._v(" "),t._l(e.spaces,function(e,a){return s("span",{key:""+a},[t._v("-"+t._s(e.name))])})],2)])}),0),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:1===t.currentIndex,expression:"currentIndex === 1"}],staticClass:"content-list-action-task-wrapper content-list-complete-task-wrapper"},t._l(t.taskCompleteMessageList,function(e,a){return s("div",{key:a+"-"+e,staticClass:"content-list-action-task-item"},[s("span",{staticClass:"status-box"},[t._v(t._s(t.stateTransfer(e.state)))]),t._v(" "),s("span",{staticClass:"task-date"},[t._v(t._s(e.planStartTime))]),t._v(" "),s("p",{staticClass:"task-btn"},[s("span",{directives:[{name:"show",rawName:"v-show",value:1!==e.state,expression:"item.state !== 1"}],staticClass:"view",on:{click:function(s){return t.taskView(e)}}},[t._v("查看任务")])]),t._v(" "),s("p",{staticClass:"work-order-number"},[s("span",{staticClass:"tit"},[t._v("工单号:")]),t._v(" "),s("span",{staticClass:"name"},[t._v(t._s(e.taskNumber))])]),t._v(" "),s("p",{staticClass:"work-info-other"},[s("span",{staticClass:"tit"},[t._v("工单:")]),t._v(" "),s("span",{staticClass:"name"},[t._v(t._s(e.taskDesc))])]),t._v(" "),s("p",{staticClass:"work-info-other"},[s("span",{staticClass:"tit"},[t._v("类型:")]),t._v(" "),s("span",{staticClass:"name"},[t._v(t._s(e.typeName))])]),t._v(" "),s("p",{staticClass:"work-info-other"},[s("span",{staticClass:"tit"},[t._v("地点:")]),t._v(" "),s("span",{staticClass:"name"},[t._v(t._s(e.depName))])])])}),0)])],1),t._v(" "),s("van-dialog",{attrs:{title:"请选择退回原因","show-cancel-button":"",width:"92%"},on:{confirm:t.reasonSure,cancel:t.reasonCancel},model:{value:t.reasonShow,callback:function(e){t.reasonShow=e},expression:"reasonShow"}},[s("div",{staticClass:"tool-name-list"},[s("div",{staticClass:"tool-name-list-title-innner"},[t._v("退回原因:")]),t._v(" "),s("div",{staticClass:"tool-name-list-content"},t._l(t.reasonOperationList,function(e,a){return s("span",{key:e+"-"+a,class:{spanStyle:t.reasonIndex===a},on:{click:function(s){return t.reasonCheck(e,a)}}},[t._v("\n              "+t._s(e.text)+"\n            ")])}),0)])])],1)},staticRenderFns:[]};var f=s("C7Lr")(m,k,!1,function(t){s("lCWz")},"data-v-6ca518ba",null);e.default=f.exports},lCWz:function(t,e){}});