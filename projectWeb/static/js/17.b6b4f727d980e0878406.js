webpackJsonp([17],{"1MUv":function(e,t){},pD4M:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("HzJ8"),n=i.n(s),r=i("4YfN"),c=i.n(r),o=i("0eBz"),a=i("0DTB"),u=(i("sqAx"),i("NxGh"),i("IcnI"),i("yl8L")),d=i("SJI6"),f=i("fdFc"),h=i("EKaR"),l={name:"CopyRecordBill",components:{HeaderTop:o.a,FooterBottom:a.a,VanFieldSelectPicker:u.a},data:function(){return{isAllRecordShow:!1,departmentNum:"",currentDepartmentId:"",currentDepartmentName:"",consumableMsgList:[]}},mounted:function(){var e=this;Object(f.b)()||(pushHistory(),this.gotoURL(function(){e.isAllRecordShow?e.isAllRecordShow=!0:e.backTo()})),this.echoCurrentDepartmentId(),this.getDepartmentNumber(),this.isRequestEnergyList()},watch:{},computed:c()({},Object(d.mapGetters)(["navTopTitle","energyRecordList","deviceServiceMsg","userInfo","isCurrentDeviceCopyServiceVerifySweepCode","completeDeviceEnergyRecordServiceOfficeInfo","currentDeviceCopyVerifySweepCodeDepNumber"]),{userName:function(){return this.userInfo.userName},userTypeId:function(){return this.userInfo.extendData.user_type_id},proId:function(){return this.userInfo.extendData.proId},proName:function(){return this.userInfo.extendData.proName},workerId:function(){return this.userInfo.extendData.userId},name:function(){return this.userInfo.name},taskId:function(){return this.deviceServiceMsg.taskId}}),methods:c()({},Object(d.mapMutations)(["changeTitleTxt","changeEnergyRecordList","changeCompleteDeviceEnergyRecordServiceOfficeInfo"]),{backTo:function(){this.storeEnergyRecord(),this.$router.push({path:"CopyDetails"}),this.changeTitleTxt({tit:"抄录详情"}),Object(f.k)("currentTitle","抄录详情")},echoCurrentDepartmentId:function(){var e=this;try{if(0==this.isCurrentDeviceCopyServiceVerifySweepCode.length)return;var t=this.isCurrentDeviceCopyServiceVerifySweepCode.indexOf(this.isCurrentDeviceCopyServiceVerifySweepCode.filter(function(t){return t.taskId==e.taskId})[0]);if(-1==t)return;this.currentDepartmentId=this.isCurrentDeviceCopyServiceVerifySweepCode[t].number,this.currentDepartmentName=Object(f.a)(JSON.parse(Object(f.h)("departmentMessage")),this.currentDepartmentId)}catch(e){this.$toast(""+e)}},getDepartmentNumber:function(){this.departmentNum=this.currentDeviceCopyVerifySweepCodeDepNumber},isRequestEnergyList:function(){var e=this;if(this.energyRecordList.length>0){var t=this.energyRecordList.indexOf(this.energyRecordList.filter(function(t){return t.taskId==e.taskId})[0]);if(-1!=t){var i=this.energyRecordList[t].officeList,s=i.indexOf(i.filter(function(t){return t.officeId==e.departmentNum})[0]);-1!=s?this.consumableMsgList=i[s].oneRecordList:this.queryDeviceMessage()}else this.queryDeviceMessage()}else this.queryDeviceMessage()},queryDeviceMessage:function(){var e=this;this.consumableMsgList=[],Object(h.f)({proId:this.proId,taskId:this.taskId,depId:this.currentDepartmentId,depNo:this.departmentNum,deviceTypeId:this.deviceServiceMsg.deviceId}).then(function(t){if(t&&200==t.data.code)if(t.data.data.length>0){var i=!0,s=!1,r=void 0;try{for(var c,o=n()(t.data.data);!(i=(c=o.next()).done);i=!0){var a=c.value;e.consumableMsgList.push({consumableName:a.deviceName,deviceNumber:a.deviceNumber,additional:a.additional,name:""})}}catch(e){s=!0,r=e}finally{try{!i&&o.return&&o.return()}finally{if(s)throw r}}}else e.$toast("没有查询到要抄录的设备");else e.$toast(""+t.data.msg)}).catch(function(t){e.$dialog.alert({message:""+t.message,closeOnPopstate:!0}).then(function(){})})},storeEnergyRecord:function(){var e=this,t=[],i=[];if(t=Object(f.e)(this.energyRecordList),this.energyRecordList.length>0){var s=this.energyRecordList.indexOf(this.energyRecordList.filter(function(t){return t.taskId==e.taskId})[0]);if(-1!=s){var n=(i=t[s].officeList).indexOf(i.filter(function(t){return t.officeId==e.departmentNum})[0]);-1!=n?i[n].oneRecordList=this.consumableMsgList:i.push({officeId:this.departmentNum,oneRecordList:this.consumableMsgList}),t[s].officeList=Object(f.j)(i)}else i.push({officeId:this.departmentNum,oneRecordList:this.consumableMsgList}),t.push({officeList:Object(f.j)(i),taskId:this.taskId})}else i.push({officeId:this.departmentNum,oneRecordList:this.consumableMsgList}),t.push({officeList:Object(f.j)(i),taskId:this.taskId});this.changeEnergyRecordList(t),Object(f.k)("energyRecordList",{energyRecord:t})},storeCompleteDepartmentNumber:function(){var e=this,t=[],i=[];if(t=Object(f.e)(this.completeDeviceEnergyRecordServiceOfficeInfo),this.completeDeviceEnergyRecordServiceOfficeInfo.length>0){var s=this.completeDeviceEnergyRecordServiceOfficeInfo.indexOf(this.completeDeviceEnergyRecordServiceOfficeInfo.filter(function(t){return t.taskId==e.taskId})[0]);-1!=s?((i=t[s].officeList).push(this.departmentNum),t[s].officeList=Object(f.j)(i)):(i.push(this.departmentNum),t.push({officeList:Object(f.j)(i),taskId:this.taskId}))}else i.push(this.departmentNum),t.push({officeList:Object(f.j)(i),taskId:this.taskId});this.changeCompleteDeviceEnergyRecordServiceOfficeInfo(t),Object(f.k)("isCompleteDeviceEnergyRecordServiceOfficeInfo",{sweepCodeInfo:t})},isBackSure:function(){this.backTo()},isBackCancel:function(){},submitEnteringData:function(){var e=this,t={proId:this.proId,taskId:this.taskId,depId:this.currentDepartmentId,depNo:this.departmentNum,deviceId:this.deviceServiceMsg.deviceId,checkItems:[]},i=!0,s=!1,r=void 0;try{for(var c,o=n()(this.consumableMsgList);!(i=(c=o.next()).done);i=!0){var a=c.value;t.checkItems.push({deviceNumber:a.deviceNumber,checkResult:a.name})}}catch(e){s=!0,r=e}finally{try{!i&&o.return&&o.return()}finally{if(s)throw r}}Object(h.z)(t).then(function(t){200==t.data.code?(e.$toast("提交成功"),e.storeEnergyRecord(),e.storeCompleteDepartmentNumber(),e.backTo()):e.$dialog.alert({message:""+t.data.msg,closeOnPopstate:!0}).then(function(){})}).catch(function(t){e.$dialog.alert({message:""+t.message,closeOnPopstate:!0}).then(function(){})})},sure:function(){this.consumableMsgList.every(function(e){return""===e.name})?this.$dialog.alert({title:"提示",message:"请录入数据"}).then(function(){}):this.consumableMsgList.some(function(e){return e.name<0})?this.$dialog.alert({title:"提示",message:"数据录入不合法"}).then(function(){}):this.consumableMsgList.some(function(e){return""===e.name})?this.isAllRecordShow=!0:this.submitEnteringData()}})},m={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"content-wrapper"},[i("div",{staticClass:"worker-show"},[i("HeaderTop",{attrs:{title:e.navTopTitle}},[i("van-icon",{attrs:{slot:"left",name:"arrow-left"},on:{click:e.backTo},slot:"left"})],1),e._v(" "),i("div",{staticClass:"content-top"},[i("div",{staticClass:"circulation-area-title"},[e._v("\n        当前抄表科室: "+e._s(e.currentDepartmentName)+"\n      ")]),e._v(" "),i("div",{staticClass:"circulation-area"},e._l(e.consumableMsgList,function(t,s){return i("p",{key:t+"-"+s},[i("span",[e._v(e._s(s+1))]),e._v(" "),i("span",[e._v("\n            "+e._s(t.consumableName)+"\n          ")]),e._v(" "),i("span",[i("van-field",{attrs:{placeholder:"请输入数据",type:"digit",error:t.name<0},model:{value:t.name,callback:function(i){e.$set(t,"name",i)},expression:"item.name"}})],1)])}),0)]),e._v(" "),i("div",{staticClass:"content-bottom"},[i("p",{staticClass:"quit-account",on:{click:e.sure}},[e._v("确认")])]),e._v(" "),i("van-dialog",{attrs:{title:"提示","show-cancel-button":"","confirm-button-text":"返回",message:"还有数据没有录入完毕,是否返回?","cancel-button-text":"不返回"},on:{confirm:e.isBackSure,cancel:e.isBackCancel},model:{value:e.isAllRecordShow,callback:function(t){e.isAllRecordShow=t},expression:"isAllRecordShow"}})],1)])},staticRenderFns:[]};var p=i("C7Lr")(l,m,!1,function(e){i("1MUv")},"data-v-14450b36",null);t.default=p.exports}});