webpackJsonp([18],{"2Iny":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("4YfN"),a=n.n(i),r=n("0eBz"),s=n("0DTB"),o=(n("sqAx"),n("NxGh")),c=(n("IcnI"),n("yl8L")),l=n("SJI6"),d=n("fdFc"),u=n("EKaR"),h={name:"DepartmentServiceIssueReport",components:{HeaderTop:r.a,FooterBottom:s.a,VanFieldSelectPicker:c.a,Loading:o.a},data:function(){return{photoBox:!1,endTimePop:!1,enlargeImgShow:!1,loadinText:"",overlayShow:!1,currentDepartmentId:"",enlargeImgUrl:"",currentDateStart:new Date,minDateEnd:new Date(2020,0,1),issueName:"",showLoadingHint:!1,pointName:"",currentTime:"",issueImageList:[],issueMessage:""}},mounted:function(){var e=this;Object(d.b)()||(pushHistory(),this.gotoURL(function(){e.$router.push({path:"departmentServiceBill"}),e.changeTitleTxt({tit:"科室巡检单"}),Object(d.k)("currentTitle","科室巡检单")})),document.addEventListener("click",function(t){"van-icon van-icon-plus"!=t.target.className&&"quit-account"!=t.target.className&&(e.photoBox=!1,e.overlayShow=!1)}),this.initDate(),this.echoCurrentDepartmentId()},watch:{},computed:a()({},Object(l.mapGetters)(["navTopTitle","userInfo","departmentServiceMsg","isCurrentDepartmentServiceVerifySweepCode","currentDepartmentServiceCheckedItemId","completeDepartmentServiceCheckedItemList"]),{userName:function(){return this.userInfo.userName},userTypeId:function(){return this.userInfo.extendData.user_type_id},proId:function(){return this.userInfo.extendData.proId},proName:function(){return this.userInfo.extendData.proName},workerId:function(){return this.userInfo.extendData.userId},name:function(){return this.userInfo.name},taskId:function(){return this.departmentServiceMsg.id}}),methods:a()({},Object(l.mapMutations)(["changeTitleTxt","changeCompleteDepartmentServiceCheckedItemList","changeCurrentDepartmentServiceCheckedItemId"]),{echoCurrentDepartmentId:function(){var e=this;if(0!=this.isCurrentDepartmentServiceVerifySweepCode.length){var t=this.isCurrentDepartmentServiceVerifySweepCode.indexOf(this.isCurrentDepartmentServiceVerifySweepCode.filter(function(t){return t.taskId==e.taskId})[0]);-1!=t&&(this.currentDepartmentId=this.isCurrentDepartmentServiceVerifySweepCode[t].number)}},backTo:function(){this.$router.push({path:"departmentServiceBill"}),this.changeTitleTxt({tit:"科室巡检单"}),Object(d.k)("currentTitle","科室巡检单")},enlargeCompleteImgEvent:function(e){this.enlargeImgShow=!0,this.enlargeImgUrl=e},timeChange:function(e){var t=e.getValues();this.currentTime=t[0]+"-"+t[1]+"-"+t[2]+" "+t[3]+":"+t[4]},initDate:function(){var e=Object(d.g)("YYYY-MM-DD hh:mm").split("-");this.currentTime=e[0]+"-"+e[1]+"-"+e[2]},issueClickEvent:function(){this.photoBox=!0,this.overlayShow=!0},issueDelete:function(e){this.issueImageList.splice(e,1)},previewFileOne:function(){var e=document.getElementById("demo1").files[0],t=this,n=new FileReader;e.size/1024/1024<16?(n.addEventListener("load",function(){var e=n.result,i=new Image;i.src=e,i.onload=function(){var e=Object(d.d)(i,void 0);t.issueImageList.push(e)}},!1),e&&n.readAsDataURL(e)):this.$dialog.alert({message:"上传图片大小不能超过16MB!",closeOnPopstate:!0}).then(function(){})},previewFileTwo:function(){var e=document.getElementById("demo2").files[0],t=this,n=new FileReader;e.size/1024/1024<16?(n.addEventListener("load",function(){var e=n.result,i=new Image;i.src=e,i.onload=function(){var e=Object(d.d)(i,void 0);t.issueImageList.push(e)}},!1),e&&n.readAsDataURL(e)):t.$dialog.alert({message:"上传图片大小不能超过16MB!",closeOnPopstate:!0}).then(function(){})},photoCancel:function(){this.photoBox=!1,this.overlayShow=!1},cancel:function(){this.$router.push({path:"departmentServiceBill"}),this.changeTitleTxt({tit:"科室巡检单"}),Object(d.k)("currentTitle","科室巡检单")},storageCompleteCheckItemInfo:function(){var e=this,t=[],n=[];if(t=Object(d.e)(this.completeDepartmentServiceCheckedItemList),this.completeDepartmentServiceCheckedItemList.length>0){var i=this.completeDepartmentServiceCheckedItemList.indexOf(this.completeDepartmentServiceCheckedItemList.filter(function(t){return t.taskId==e.taskId})[0]);if(-1!=i){n=t[i].officeList;var a=this.currentDepartmentServiceCheckedItemId;n=n.filter(function(t){return t.id!==e.currentDepartmentServiceCheckedItemId.id}),a.checkResult=2,this.changeCurrentDepartmentServiceCheckedItemId(a),n.push(this.currentDepartmentServiceCheckedItemId),t[i].officeList=Object(d.j)(n),t[i].depId=this.currentDepartmentId}else{var r=this.currentDepartmentServiceCheckedItemId;r.checkResult=2,this.changeCurrentDepartmentServiceCheckedItemId(r),n.push(this.currentDepartmentServiceCheckedItemId),t.push({officeList:Object(d.j)(n),taskId:this.taskId,depId:this.currentDepartmentId})}}else{var s=this.currentDepartmentServiceCheckedItemId;s.checkResult=2,this.changeCurrentDepartmentServiceCheckedItemId(s),n.push(this.currentDepartmentServiceCheckedItemId),t.push({officeList:Object(d.j)(n),taskId:this.taskId,depId:this.currentDepartmentId})}this.changeCompleteDepartmentServiceCheckedItemList(t),Object(d.k)("isCompleteDepartmentServiceCheckedItemList",{sweepCodeInfo:t})},completeTask:function(){var e=this;this.loadinText="上报中,请稍等···",this.showLoadingHint=!0,this.overlayShow=!0;var t={taskDesc:this.issueName,taskRemark:this.issueMessage,depId:this.currentDepartmentId,workerId:this.workerId,workerName:"",space:this.pointName,proId:this.proId,images:this.issueImageList};Object(u.v)(t).then(function(t){e.showLoadingHint=!1,e.overlayShow=!1,t&&200==t.data.code?(e.$toast("上报成功"),e.storageCompleteCheckItemInfo(),e.$router.push({path:"departmentServiceBill"}),e.changeTitleTxt({tit:"科室巡检单"}),Object(d.k)("currentTitle","科室巡检单")):e.$toast(""+t.data.msg)}).catch(function(t){e.$dialog.alert({message:""+t.message,closeOnPopstate:!0}).then(function(){}),e.showLoadingHint=!1,e.overlayShow=!1})}})},p={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"content-wrapper"},[n("van-overlay",{attrs:{show:e.overlayShow}}),e._v(" "),n("div",{staticClass:"worker-show"},[n("HeaderTop",{attrs:{title:e.navTopTitle}},[n("van-icon",{attrs:{slot:"left",name:"arrow-left"},on:{click:e.backTo},slot:"left"})],1),e._v(" "),n("div",{staticClass:"loading"},[n("loading",{attrs:{isShow:e.showLoadingHint,textContent:e.loadinText,textColor:"#2895ea"}})],1),e._v(" "),n("div",{staticClass:"content-top"},[n("div",{staticClass:"content-top-other"},[n("p",[e._v("问题名称")]),e._v(" "),n("p",[n("van-field",{attrs:{placeholder:"请输入问题名称"},model:{value:e.issueName,callback:function(t){e.issueName=t},expression:"issueName"}})],1)]),e._v(" "),n("div",{staticClass:"content-top-other"},[n("p",[e._v("地点")]),e._v(" "),n("p",[n("van-field",{attrs:{placeholder:"请输入地点"},model:{value:e.pointName,callback:function(t){e.pointName=t},expression:"pointName"}})],1)]),e._v(" "),n("div",{staticClass:"content-top-other-last"},[n("p",[e._v("时间")]),e._v(" "),n("p",[n("van-field",{attrs:{placeholder:"请选择时间",readonly:"readonly"},on:{click:function(t){e.endTimePop=!0}},model:{value:e.currentTime,callback:function(t){e.currentTime=t},expression:"currentTime"}})],1)])]),e._v(" "),n("div",{staticClass:"content-middle"},[n("p",{staticClass:"issue-photo"},[n("span",[e._v("问题拍照")]),e._v(" "),n("ul",{staticClass:"photo-list"},e._l(e.issueImageList,function(t,i){return n("li",{key:t+"-"+i},[n("img",{attrs:{width:"100",height:"130",src:t},on:{click:function(n){return e.enlargeCompleteImgEvent(t)}}}),e._v(" "),n("van-icon",{attrs:{name:"cross"},on:{click:function(t){return e.issueDelete(i)}}})],1)}),0),e._v(" "),n("span",{staticClass:"icon-wrapper",on:{click:e.issueClickEvent}},[n("van-icon",{attrs:{name:"plus"}})],1)]),e._v(" "),n("div",{staticClass:"content-top-name"},[n("p",[e._v("问题描述")]),e._v(" "),n("p",[n("van-field",{attrs:{rows:"1",autosize:"",type:"textarea",placeholder:"请输入问题描述"},model:{value:e.issueMessage,callback:function(t){e.issueMessage=t},expression:"issueMessage"}})],1)])]),e._v(" "),n("div",{staticClass:"content-bottom"},[n("p",{staticClass:"back-home",on:{click:e.cancel}},[e._v("取消")]),e._v(" "),n("p",{staticClass:"quit-account",on:{click:e.completeTask}},[e._v("确认上报")])]),e._v(" "),n("transition",{attrs:{name:"van-slide-up"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.photoBox,expression:"photoBox"}],staticClass:"choose-photo-box"},[n("div",{staticClass:"choose-photo"},[n("van-icon",{attrs:{name:"photo"}}),e._v(" "),n("input",{attrs:{name:"uploadImg1",id:"demo1",type:"file",accept:"image/album"},on:{change:e.previewFileOne}}),e._v("从图库中选择\n        ")],1),e._v(" "),n("div",{staticClass:"photo-graph"},[n("van-icon",{attrs:{name:"photograph"}}),e._v(" "),n("input",{attrs:{name:"uploadImg2",id:"demo2",type:"file",accept:"image/camera"},on:{change:e.previewFileTwo}}),e._v("拍照\n        ")],1),e._v(" "),n("div",{staticClass:"photo-cancel",on:{click:e.photoCancel}},[e._v("取消")])])])],1),e._v(" "),n("van-popup",{attrs:{title:"",position:"bottom",overlay:!0},model:{value:e.endTimePop,callback:function(t){e.endTimePop=t},expression:"endTimePop"}},[n("van-datetime-picker",{attrs:{type:"datetime","min-date":e.minDateEnd},on:{cancel:function(t){e.endTimePop=!1},confirm:function(t){e.endTimePop=!1},change:e.timeChange},model:{value:e.currentDateStart,callback:function(t){e.currentDateStart=t},expression:"currentDateStart"}})],1),e._v(" "),n("van-dialog",{attrs:{width:"90%"},model:{value:e.enlargeImgShow,callback:function(t){e.enlargeImgShow=t},expression:"enlargeImgShow"}},[n("img",{attrs:{src:e.enlargeImgUrl}})])],1)},staticRenderFns:[]};var m=n("C7Lr")(h,p,!1,function(e){n("Jj0h")},"data-v-1441e821",null);t.default=m.exports},Jj0h:function(e,t){}});