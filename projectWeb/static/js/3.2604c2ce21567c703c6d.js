webpackJsonp([3],{gh9j:function(t,e,i){"use strict";var s=i("4YfN"),n=i.n(s),o=i("SJI6"),a=i("fdFc"),r={name:"ElectronicSignature",data:function(){return{ctx:null,point:{x:0,y:0},moving:!1,stageInfo:"",signNatureData:"",imgUrl:"",client:{},points:[],canvasTxt:null,startX:0,startY:0,moveY:0,moveX:0,endY:0,endX:0,w:null,h:null,isDown:!1}},mounted:function(){var t=this.$refs.board;t.width=this.$refs.boardBox.offsetWidth,t.height=this.$refs.boardBox.offsetHeight,this.ctx=t.getContext("2d"),this.ctx.strokeStyle="#000",this.ctx.lineWidth=2,this.changeCurrentElectronicSignature({DtMsg:this.$refs.board.toDataURL("image/png")}),this.changeOriginalSignature(this.$refs.board.toDataURL("image/png"))},computed:n()({},Object(o.mapGetters)(["currentElectronicSignature","originalSignature"])),methods:n()({},Object(o.mapMutations)(["changeCurrentElectronicSignature","changeOriginalSignature"]),{touchStart:function(t){var e=t.touches[0].clientX-t.target.offsetLeft,i=t.touches[0].clientY-t.target.offsetTop;this.point.x=e,this.point.y=i,this.ctx.beginPath(),this.ctx.moveTo(this.point.x,this.point.y),this.ctx.lineTo(e,i),this.ctx.stroke(),this.ctx.closePath(),this.moving=!0},touchMove:function(t){if(this.moving){var e=t.touches[0].clientX-t.target.offsetLeft,i=t.touches[0].clientY-t.target.offsetTop;this.ctx.beginPath(),this.ctx.moveTo(this.point.x,this.point.y),this.ctx.lineTo(e,i),this.ctx.stroke(),this.ctx.closePath(),this.point.x=e,this.point.y=i}},touchEnd:function(t){if(this.moving){var e=t.touches[0].clientX-t.target.offsetLeft,i=t.touches[0].clientY-t.target.offsetTop;this.ctx.beginPath(),this.ctx.moveTo(this.point.x,this.point.y),this.ctx.lineTo(e,i),this.ctx.stroke(),this.ctx.closePath(),this.moving=!1}},mouseDown:function(t){(t=t||event).preventDefault();var e={x:t.offsetX,y:t.offsetY};this.startX=e.x,this.startY=e.y,this.ctx.beginPath(),this.ctx.moveTo(this.startX,this.startY),this.ctx.lineTo(e.x,e.y),this.ctx.stroke(),this.ctx.closePath(),this.points.push(e),this.isDown=!0},mouseMove:function(t){if((t=t||event).preventDefault(),this.isDown){var e={x:t.offsetX,y:t.offsetY};this.moveY=e.y,this.moveX=e.x,this.ctx.beginPath(),this.ctx.moveTo(this.startX,this.startY),this.ctx.lineTo(e.x,e.y),this.ctx.stroke(),this.ctx.closePath(),this.startY=e.y,this.startX=e.x,this.points.push(e)}},mouseUp:function(t){(t=t||event).preventDefault();var e={x:t.offsetX,y:t.offsetY};this.ctx.beginPath(),this.ctx.moveTo(this.startX,this.startY),this.ctx.lineTo(e.x,e.y),this.ctx.stroke(),this.ctx.closePath(),this.points.push(e),this.points.push({x:-1,y:-1}),this.isDown=!1},overwrite:function(){this.ctx.clearRect(0,0,this.$refs.board.width,this.$refs.board.height),this.changeCurrentElectronicSignature({DtMsg:null}),this.changeOriginalSignature(this.$refs.board.toDataURL("image/png")),this.points=[]},commitSure:function(){if(this.originalSignature!=this.$refs.board.toDataURL("image/png")){this.imgUrl=this.$refs.board.toDataURL(),this.signNatureData=this.$refs.board.toDataURL("image/png"),this.changeCurrentElectronicSignature({DtMsg:this.$refs.board.toDataURL("image/png")});Object(a.c)(this.$refs.board.toDataURL());this.changeOriginalSignature(null)}else this.$dialog.alert({message:"请签名",closeOnPopstate:!1}).then(function(){})}})},c={render:function(){var t=this.$createElement,e=this._self._c||t;return e("section",{staticClass:"signature"},[e("div",{staticClass:"signatureBox"},[e("div",{ref:"boardBox",staticClass:"canvasBox",attrs:{currentSinnatureData:this.signNatureData}},[e("canvas",{ref:"board",on:{touchstart:this.touchStart,touchmove:this.touchMove,touchend:this.touchEnd,mousedown:this.mouseDown,mousemove:this.mouseMove,mouseup:this.mouseUp}})])])])},staticRenderFns:[]};var h=i("C7Lr")(r,c,!1,function(t){i("yUW5")},"data-v-25d0e4d1",null);e.a=h.exports},i7Fe:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("4YfN"),n=i.n(s),o=i("0eBz"),a=i("0DTB"),r=i("gh9j"),c=(i("sqAx"),i("NxGh")),h=(i("IcnI"),i("yl8L")),u=i("SJI6"),l=i("EKaR"),f=i("fdFc"),g={name:"WorkOrderSignature",components:{HeaderTop:o.a,FooterBottom:a.a,VanFieldSelectPicker:h.a,ElectronicSignature:r.a,Loading:c.a},data:function(){return{showLoadingHint:!1,loadinText:"",overlayShow:!1}},mounted:function(){var t=this;this.$refs.contentTop.style.zIndex=100,Object(f.b)()||(pushHistory(),this.gotoURL(function(){t.$router.push({path:"workOrderDetails"}),t.changeTitleTxt({tit:"工单详情"}),Object(f.k)("currentTitle","工单详情")}))},watch:{},computed:n()({},Object(u.mapGetters)(["navTopTitle","currentElectronicSignature","repairsWorkOrderMsg","originalSignature","userInfo"]),{userName:function(){return this.userInfo.userName},userTypeId:function(){return this.userInfo.extendData.user_type_id},proId:function(){return this.userInfo.extendData.proId},proName:function(){return this.userInfo.extendData.proName},workerId:function(){return this.userInfo.extendData.userId},name:function(){return this.userInfo.name},taskId:function(){return this.repairsWorkOrderMsg.id}}),methods:n()({},Object(u.mapMutations)(["changeTitleTxt"]),{backTo:function(){this.$router.push({path:"workOrderDetails"}),this.changeTitleTxt({tit:"工单详情"}),Object(f.k)("currentTitle","工单详情")},sure:function(){var t=this;if(this.$refs.mychild.commitSure(),this.currentElectronicSignature!=this.originalSignature&&this.currentElectronicSignature){this.$refs.contentTop.style.zIndex=0,this.loadinText="上传中,请稍等···",this.showLoadingHint=!0,this.overlayShow=!0;var e={taskId:this.taskId,images:[]};e.images=[],e.images.push({imgType:0,image:this.currentElectronicSignature}),Object(l.E)(e).then(function(e){t.showLoadingHint=!1,t.overlayShow=!1,e&&200==e.data.code?(t.$toast(""+e.data.msg),t.rewrite(),t.updateTaskComplete()):t.$toast(""+e.data.msg)}).catch(function(e){t.$dialog.alert({message:""+e.message,closeOnPopstate:!0}).then(function(){}),t.showLoadingHint=!1,t.overlayShow=!1}),console.log("sas1",this.currentElectronicSignature)}},rewrite:function(){this.$refs.mychild.overwrite()},updateTaskComplete:function(){var t=this;Object(l.d)({proId:this.proId,taskId:this.taskId}).then(function(e){e&&200==e.data.code?(t.$toast(""+e.data.msg),t.$router.push({path:"repairsWorkOrder"}),t.changeTitleTxt({tit:"报修工单"}),Object(f.k)("currentTitle","报修工单")):t.$toast(""+e.data.msg)}).catch(function(e){t.$dialog.alert({message:""+e.message,closeOnPopstate:!0}).then(function(){})})},cancel:function(){this.$refs.mychild.overwrite(),this.$router.push({path:"workOrderDetails"}),this.changeTitleTxt({tit:"工单详情"}),Object(f.k)("currentTitle","工单详情")}})},d={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"content-wrapper"},[i("van-overlay",{attrs:{show:t.overlayShow}}),t._v(" "),i("div",{staticClass:"worker-show"},[i("HeaderTop",{attrs:{title:t.navTopTitle}},[i("van-icon",{attrs:{slot:"left",name:"arrow-left"},on:{click:t.backTo},slot:"left"})],1),t._v(" "),i("div",{staticClass:"loading"},[i("loading",{attrs:{isShow:t.showLoadingHint,textContent:t.loadinText,textColor:"#2895ea"}})],1),t._v(" "),i("div",{ref:"contentTop",staticClass:"content-top"},[i("ElectronicSignature",{ref:"mychild"})],1),t._v(" "),i("div",{staticClass:"content-bottom"},[i("span",{on:{click:t.sure}},[t._v("确认")]),t._v(" "),i("span",{on:{click:t.rewrite}},[t._v("重写")]),t._v(" "),i("span",{on:{click:t.cancel}},[t._v("取消")])])],1)],1)},staticRenderFns:[]};var p=i("C7Lr")(g,d,!1,function(t){i("oi4c")},"data-v-99a7033e",null);e.default=p.exports},oi4c:function(t,e){},yUW5:function(t,e){}});