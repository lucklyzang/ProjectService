webpackJsonp([15],{"665y":function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=e("HzJ8"),n=e.n(a),i=e("4YfN"),r=e.n(i),o=e("0eBz"),c=e("0DTB"),l=e("sqAx"),v=e("NxGh"),h=e("SJI6"),p=e("IcnI"),u=e("fdFc"),d=e("EKaR"),_={name:"DeviceService",data:function(){return{noDataShow:!1,showLoadingHint:!1,isRefresh:!1,currentIndex:0,tabTitleList:["可接任务","待办任务","已完成"],acceptableTaskList:[],waitTaskList:[],completeTaskList:[]}},components:{HeaderTop:o.a,NoData:l.a,Loading:v.a,FooterBottom:c.a},computed:r()({},Object(h.mapGetters)(["navTopTitle","userInfo","catch_components","isFreshDeviceServicePage"]),{proId:function(){return this.userInfo.extendData.proId},workerId:function(){return JSON.parse(Object(u.h)("userInfo")).extendData.userId}}),watch:{},beforeRouteEnter:function(t,s,e){var a=p.a.state.catchComponent.catch_components;-1===a.indexOf("DeviceService")&&a.push("DeviceService"),console.log(p.a.state.catchComponent.catch_components),e()},beforeRouteLeave:function(t,s,e){var a=this.catch_components;"copyDetails"!==t.name&&"deviceServiceDetails"!==t.name&&"operateRecordOrderDetails"!==t.name&&(a.indexOf("DeviceService")>-1&&this.changeCatchComponent([]));e()},mounted:function(){var t=this;if(!Object(u.b)()){pushHistory(),this.gotoURL(function(){pushHistory(),t.$router.push({path:"home"}),t.changeTitleTxt({tit:"工程管理系统"}),Object(u.k)("currentTitle","工程管理系统")})}this.isFreshDeviceServicePage&&this.getAllEnergyTask({proId:this.proId,workerId:this.workerId,state:this.currentIndex+1,startDate:"",endDate:""},this.currentIndex)},activated:function(){var t=this;if(!Object(u.b)()){pushHistory(),this.gotoURL(function(){pushHistory(),t.$router.push({path:"home"}),t.changeTitleTxt({tit:"工程管理系统"}),Object(u.k)("currentTitle","工程管理系统")})}this.isFreshDeviceServicePage&&this.getAllEnergyTask({proId:this.proId,workerId:this.workerId,state:this.currentIndex+1,startDate:"",endDate:""},this.currentIndex)},methods:r()({},Object(h.mapMutations)(["changeTitleTxt","changeDeviceServiceMsg","changeCatchComponent"]),{stateTransfer:function(t){switch(t){case 1:return"待领取";case 2:return"待完成";case 4:return"已完成"}},getAllEnergyTask:function(t,s){var e=this;this.noDataShow=!1,this.showLoadingHint=!0,Object(d.i)(t).then(function(t){if(e.showLoadingHint=!1,e.acceptableTaskList=[],e.waitTaskList=[],e.completeTaskList=[],t&&200==t.data.code)if(e.isRefresh=!1,t.data.data.length>0){e.noDataShow=!1;var a=!0,i=!1,r=void 0;try{for(var o,c=n()(t.data.data);!(a=(o=c.next()).done);a=!0){var l=o.value;0==s?e.acceptableTaskList.push({taskId:l.id,taskNumber:l.taskNumber,taskName:l.taskName,state:l.state,startTime:l.startTime,spaces:l.spaces,deviceCount:l.deviceCount,hasSpaces:l.hasSpaces,hasInput:l.hasInput,currentTimes:l.currentTimes,deviceId:l.deviceId,createTime:l.createTime}):1==s?e.waitTaskList.push({taskId:l.id,taskNumber:l.taskNumber,taskName:l.taskName,state:l.state,startTime:l.startTime,spaces:l.spaces,deviceCount:l.deviceCount,hasSpaces:l.hasSpaces,hasInput:l.hasInput,currentTimes:l.currentTimes,deviceId:l.deviceId,createTime:l.createTime}):e.completeTaskList.push({taskId:l.id,taskNumber:l.taskNumber,taskName:l.taskName,state:l.state,startTime:l.startTime,spaces:l.spaces,deviceCount:l.deviceCount,hasSpaces:l.hasSpaces,hasInput:l.hasInput,currentTimes:l.currentTimes,deviceId:l.deviceId,createTime:l.createTime})}}catch(t){i=!0,r=t}finally{try{!a&&c.return&&c.return()}finally{if(i)throw r}}}else e.noDataShow=!0}).catch(function(t){e.$dialog.alert({message:""+t.message,closeOnPopstate:!0}).then(function(){}),e.showLoadingHint=!1})},liClickEvent:function(t,s){this.currentIndex=s,0==s?this.getAllEnergyTask({proId:this.proId,workerId:this.workerId,state:1,startDate:"",endDate:""},s):1==s?this.getAllEnergyTask({proId:this.proId,workerId:this.workerId,state:2,startDate:"",endDate:""},s):this.getAllEnergyTask({proId:this.proId,workerId:this.workerId,state:4,startDate:"",endDate:""},s)},onRefresh:function(){this.getAllEnergyTask({proId:this.proId,workerId:this.workerId,state:0==this.currentIndex?1:1==this.currentIndex?2:4,startDate:"",endDate:""},this.currentIndex)},taskView:function(t){var s=this;1!=t.state?(this.$router.push({path:"CopyDetails"}),this.changeTitleTxt({tit:"抄录详情"}),Object(u.k)("currentTitle","抄录详情"),this.changeDeviceServiceMsg(t),Object(u.k)("deviceServiceMsg",t)):Object(d.e)(this.proId,t.taskId).then(function(t){t&&200==t.data.code?s.getAllEnergyTask({proId:s.proId,workerId:s.workerId,state:1,startDate:"",endDate:""},0):s.$dialog.alert({message:""+t.data.msg,closeOnPopstate:!0}).then(function(){})}).catch(function(t){s.$dialog.alert({message:""+t.message,closeOnPopstate:!0}).then(function(){})})},backTo:function(){this.$router.push({path:"home"}),this.changeTitleTxt({tit:"工程管理系统"}),Object(u.k)("currentTitle","工程管理系统")}})},k={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content-wrapper"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.noDataShow,expression:"noDataShow"}],staticClass:"no-data"},[e("NoData")],1),t._v(" "),e("div",{staticClass:"loading"},[e("loading",{attrs:{isShow:t.showLoadingHint,textContent:"加载中,请稍候····",textColor:"#2895ea"}})],1),t._v(" "),e("HeaderTop",{attrs:{title:t.navTopTitle}},[e("van-icon",{attrs:{slot:"left",name:"arrow-left"},on:{click:t.backTo},slot:"left"})],1),t._v(" "),e("div",{staticClass:"content-top"},[e("ul",{staticClass:"tab-title"},t._l(t.tabTitleList,function(s,a){return e("li",{key:""+a,class:{liStyle:t.currentIndex==a},on:{click:function(e){return t.liClickEvent(s,a)}}},[t._v(t._s(s))])}),0)]),t._v(" "),e("div",{staticClass:"content-bottom"},[e("van-pull-refresh",{attrs:{"success-text":"刷新成功"},on:{refresh:t.onRefresh},model:{value:t.isRefresh,callback:function(s){t.isRefresh=s},expression:"isRefresh"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:0==t.currentIndex,expression:"currentIndex == 0"}],staticClass:"content-list-action-task-wrapper"},t._l(t.acceptableTaskList,function(s,a){return e("div",{key:a+"-"+s,staticClass:"content-list-action-task-item"},[e("span",{staticClass:"status-box",class:{statusBoxStyle:2==s.state}},[t._v(t._s(t.stateTransfer(s.state)))]),t._v(" "),e("span",{staticClass:"task-date"},[t._v(t._s(s.startTime))]),t._v(" "),e("p",{staticClass:"task-btn"},[e("span",{staticClass:"view",on:{click:function(e){return t.taskView(s)}}},[t._v("领取任务")])]),t._v(" "),e("p",{staticClass:"work-order-number"},[e("span",{staticClass:"tit"},[t._v("巡检单号:")]),t._v(" "),e("span",{staticClass:"name"},[t._v(t._s(s.taskNumber))])]),t._v(" "),e("p",{staticClass:"work-info-other"},[e("span",{staticClass:"tit"},[t._v("巡检名称:")]),t._v(" "),e("span",{staticClass:"name"},[t._v(t._s(s.taskName))])]),t._v(" "),e("p",{staticClass:"work-info-other work-info-other-row"},[e("span",{staticClass:"tit"},[t._v("当前次数:")]),t._v(" "),e("span",{staticClass:"name"},[t._v(t._s(s.currentTimes))])]),t._v(" "),e("p",{staticClass:"work-info-other work-info-other-row"},[e("span",{staticClass:"tit"},[t._v("类型:")]),t._v(" "),e("span",{staticClass:"name name-other"},[t._v("常规巡检")])]),t._v(" "),e("p",{staticClass:"work-info-other work-info-other-row"},[e("span",{staticClass:"tit"},[t._v("已完成设备:")]),t._v(" "),e("span",{staticClass:"name name-other"},[t._v(t._s(s.hasInput))])]),t._v(" "),e("p",{staticClass:"work-info-other work-info-other-row"},[e("span",{staticClass:"tit"},[t._v("未完成设备:")]),t._v(" "),e("span",{staticClass:"name name-other"},[t._v(t._s(s.deviceCount-s.hasInput))])])])}),0),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:1==t.currentIndex,expression:"currentIndex == 1"}],staticClass:"content-list-action-task-wrapper content-list-complete-task-wrapper"},t._l(t.waitTaskList,function(s,a){return e("div",{key:a+"-"+s,staticClass:"content-list-action-task-item"},[e("span",{staticClass:"status-box",class:{statusBoxStyle:2==s.state}},[t._v(t._s(t.stateTransfer(s.state)))]),t._v(" "),e("span",{staticClass:"task-date"},[t._v(t._s(s.startTime))]),t._v(" "),e("p",{staticClass:"task-btn"},[e("span",{staticClass:"view",on:{click:function(e){return t.taskView(s)}}},[t._v("查看任务")])]),t._v(" "),e("p",{staticClass:"work-order-number"},[e("span",{staticClass:"tit"},[t._v("巡检单号:")]),t._v(" "),e("span",{staticClass:"name"},[t._v(t._s(s.taskNumber))])]),t._v(" "),e("p",{staticClass:"work-info-other"},[e("span",{staticClass:"tit"},[t._v("巡检名称:")]),t._v(" "),e("span",{staticClass:"name"},[t._v(t._s(s.taskName))])]),t._v(" "),e("p",{staticClass:"work-info-other work-info-other-row"},[e("span",{staticClass:"tit"},[t._v("当前次数:")]),t._v(" "),e("span",{staticClass:"name"},[t._v(t._s(s.currentTimes))])]),t._v(" "),e("p",{staticClass:"work-info-other work-info-other-row"},[e("span",{staticClass:"tit"},[t._v("类型:")]),t._v(" "),e("span",{staticClass:"name name-other"},[t._v("常规巡检")])]),t._v(" "),e("p",{staticClass:"work-info-other work-info-other-row"},[e("span",{staticClass:"tit"},[t._v("已完成设备:")]),t._v(" "),e("span",{staticClass:"name name-other"},[t._v(t._s(s.hasInput))])]),t._v(" "),e("p",{staticClass:"work-info-other work-info-other-row"},[e("span",{staticClass:"tit"},[t._v("未完成设备:")]),t._v(" "),e("span",{staticClass:"name name-other"},[t._v(t._s(s.deviceCount-s.hasInput))])])])}),0),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:2==t.currentIndex,expression:"currentIndex == 2"}],staticClass:"content-list-action-task-wrapper content-list-complete-task-wrapper"},t._l(t.completeTaskList,function(s,a){return e("div",{key:a+"-"+s,staticClass:"content-list-action-task-item"},[e("span",{staticClass:"status-box",class:{statusBoxStyle:2==s.state}},[t._v(t._s(t.stateTransfer(s.state)))]),t._v(" "),e("span",{staticClass:"task-date"},[t._v(t._s(s.startTime))]),t._v(" "),e("p",{staticClass:"task-btn"},[e("span",{staticClass:"view",on:{click:function(e){return t.taskView(s)}}},[t._v("查看任务")])]),t._v(" "),e("p",{staticClass:"work-order-number"},[e("span",{staticClass:"tit"},[t._v("巡检单号:")]),t._v(" "),e("span",{staticClass:"name"},[t._v(t._s(s.taskNumber))])]),t._v(" "),e("p",{staticClass:"work-info-other"},[e("span",{staticClass:"tit"},[t._v("巡检名称:")]),t._v(" "),e("span",{staticClass:"name"},[t._v(t._s(s.taskName))])]),t._v(" "),e("p",{staticClass:"work-info-other work-info-other-row"},[e("span",{staticClass:"tit"},[t._v("当前次数:")]),t._v(" "),e("span",{staticClass:"name"},[t._v(t._s(s.currentTimes))])]),t._v(" "),e("p",{staticClass:"work-info-other work-info-other-row"},[e("span",{staticClass:"tit"},[t._v("类型:")]),t._v(" "),e("span",{staticClass:"name name-other"},[t._v("常规巡检")])]),t._v(" "),e("p",{staticClass:"work-info-other work-info-other-row"},[e("span",{staticClass:"tit"},[t._v("已完成设备:")]),t._v(" "),e("span",{staticClass:"name name-other"},[t._v(t._s(s.hasInput))])]),t._v(" "),e("p",{staticClass:"work-info-other work-info-other-row"},[e("span",{staticClass:"tit"},[t._v("未完成设备:")]),t._v(" "),e("span",{staticClass:"name name-other"},[t._v(t._s(s.deviceCount-s.hasInput))])])])}),0)])],1)],1)},staticRenderFns:[]};var m=e("C7Lr")(_,k,!1,function(t){e("MvNQ")},"data-v-47caa913",null);s.default=m.exports},MvNQ:function(t,s){}});