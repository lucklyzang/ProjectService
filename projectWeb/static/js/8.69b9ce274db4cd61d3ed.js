webpackJsonp([8],{"F/To":function(t,e){},ye5i:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("HzJ8"),o=s.n(i),a=s("rVsN"),r=s.n(a),n=s("4YfN"),h=s.n(n),l=s("0eBz"),c=s("0DTB"),p=(s("sqAx"),s("NxGh")),u=(s("IcnI"),s("yl8L")),m=s("SJI6"),g=s("EKaR"),d=s("fdFc"),v={name:"WorkOrderDetails",components:{HeaderTop:l.a,FooterBottom:c.a,VanFieldSelectPicker:u.a,Loading:p.a},data:function(){return{photoBox:!1,isFinishShow:!1,isChangeConsumableShow:!1,showLoadingHint:!1,overlayShow:!1,imgType:"",photoType:"",loadinText:"",clickIssue:!1,clickComplete:!1,issueImageList:[],completeImageList:[],historyIssueImageList:[],historyCompleteImageList:[],photonList:[],enlargeImgShow:!1,oneRepairsMsg:"",enlargeImgUrl:""}},mounted:function(){var t=this;if(!Object(d.b)()){if(pushHistory(),this.isFinishShow)return void(this.isFinishShow=!0);5==this.repairsWorkOrderMsg.state?this.changeIsFreshRepairsWorkOrderPage(!1):this.changeIsFreshRepairsWorkOrderPage(!0),this.gotoURL(function(){t.$router.push({path:"repairsWorkOrder"}),t.changeTitleTxt({tit:"报修工单"}),Object(d.k)("currentTitle","报修工单")})}document.addEventListener("click",function(e){"van-icon van-icon-plus"!=e.target.className&&"back-home"!=e.target.className&&"quit-account"!=e.target.className&&(t.photoBox=!1,t.overlayShow=!1)}),5==this.repairsWorkOrderMsg.state?(this.getOneRepairsProjectNoComplete(this.taskId),this.parallelFunction()):(this.echoPhoto(),this.getOneRepairsProjectNoComplete(this.taskId)),this.echoIsMaterial(),this.changeElementSite()},watch:{issueImageList:{handler:function(t,e){0==t.length&&this.completeImageList.length},immediate:!0,deep:!0},completeImageList:{handler:function(t,e){0==t.length&&this.issueImageList.length},immediate:!0,deep:!0}},computed:h()({},Object(m.mapGetters)(["navTopTitle","repairsWorkOrderMsg","userInfo","isCompleteRepairsWorkOrderPhotoList","isFillMaterialList"]),{userName:function(){return this.userInfo.userName},userTypeId:function(){return this.userInfo.extendData.user_type_id},proId:function(){return this.userInfo.extendData.proId},proName:function(){return this.userInfo.extendData.proName},workerId:function(){return this.userInfo.extendData.userId},name:function(){return this.userInfo.name},taskId:function(){return this.repairsWorkOrderMsg.id}}),methods:h()({},Object(m.mapMutations)(["changeTitleTxt","changeIsFreshRepairsWorkOrderPage","changeIsCompletePhotoList","changeisFillMaterialList"]),{backTo:function(){5==this.repairsWorkOrderMsg.state?this.changeIsFreshRepairsWorkOrderPage(!1):this.changeIsFreshRepairsWorkOrderPage(!0),this.$router.push({path:"repairsWorkOrder"}),this.changeTitleTxt({tit:"报修工单"}),Object(d.k)("currentTitle","报修工单")},changeElementSite:function(){4==this.repairsWorkOrderMsg.state?(this.$refs.contentBottom.style.position="absolute",this.$refs.contentBottom.style.bottom=0,this.$refs.contentBottom.style.left=0):this.$refs.contentBottom.style.position="relative"},echoIsMaterial:function(){var t=this;try{if(0==this.isFillMaterialList.length)return void(this.isChangeConsumableShow=!1);var e=this.isFillMaterialList.indexOf(this.isFillMaterialList.filter(function(e){return e.taskId==t.taskId})[0]);if(-1==e)return void(this.isChangeConsumableShow=!1);this.isChangeConsumableShow=this.isFillMaterialList[e].isFilledMaterial}catch(t){this.$toast(""+t)}},storageIsMaterial:function(){var t=this,e=[];if((e=Object(d.e)(this.isFillMaterialList)).length>0){var s=this.isFillMaterialList.indexOf(this.isFillMaterialList.filter(function(e){return e.taskId==t.taskId})[0]);-1!=s?e[s].isFilledMaterial=!0:e.push({isFilledMaterial:!0,taskId:this.taskId})}else e.push({isFilledMaterial:!0,taskId:this.taskId});this.changeisFillMaterialList(e),Object(d.k)("isFillMaterialList",{number:e})},clearStorageMaterial:function(){var t=this;if(0!=this.isFillMaterialList.length){var e=this.isFillMaterialList.filter(function(e){return e.taskId!==t.taskId});this.changeisFillMaterialList(e),Object(d.k)("isFillMaterialList",{number:e})}},enlargeIssueImgEvent:function(t){this.enlargeImgShow=!0,this.enlargeImgUrl=t},enlargeCompleteImgEvent:function(t){this.enlargeImgShow=!0,this.enlargeImgUrl=t},parallelFunction:function(){var t=this;this.loadinText="加载中,请稍等···",this.showLoadingHint=!0,this.overlayShow=!0,r.a.all([this.getOneRepairsProjectPhoto()]).then(function(e){if(t.showLoadingHint=!1,t.overlayShow=!1,e.length>0&&(t.photonList=e[0],t.photonList.length>0))for(var s=0,i=t.photonList.length;s<i;s++)1==t.photonList[s].imgType?t.historyIssueImageList.push(t.photonList[s].imgSign):2==t.photonList[s].imgType&&t.historyCompleteImageList.push(t.photonList[s].imgSign)}).catch(function(e){t.$dialog.alert({message:""+e,closeOnPopstate:!0}).then(function(){}),t.showLoadingHint=!1,t.overlayShow=!1})},getOneRepairsProjectNoComplete:function(){var t=this;Object(g.r)(this.taskId).then(function(e){e&&200==e.data.code&&(t.oneRepairsMsg=e.data.data)}).catch(function(e){t.$dialog.alert({message:""+e,closeOnPopstate:!0}).then(function(){})})},getOneRepairsProjectPhoto:function(){var t=this;return new r.a(function(e,s){Object(g.t)({taskId:t.taskId,imgType:-1}).then(function(t){t&&200==t.data.code&&e(t.data.data)}).catch(function(t){s(t.message)})})},issueClickEvent:function(){this.photoType=1,this.photoBox=!0,this.clickIssue=!0,this.clickComplete=!1,this.overlayShow=!0},completeClickEvent:function(){this.photoType=2,this.photoBox=!0,this.clickIssue=!1,this.clickComplete=!0,this.overlayShow=!0},issueDelete:function(t){this.photoType=1,this.issueImageList.splice(t,1),this.storePhoto(this.issueImageList,this.photoType)},completeDelete:function(t){this.photoType=2,this.completeImageList.splice(t,1),this.storePhoto(this.completeImageList,this.photoType)},photoCancel:function(){this.photoBox=!1,this.overlayShow=!1},previewFileOne:function(){var t=document.getElementById("demo1").files[0],e=this,s=new FileReader;t.size/1024/1024<16?(s.addEventListener("load",function(){var t=s.result,i=new Image;i.src=t,i.onload=function(){var t=Object(d.d)(i,void 0);e.clickIssue?(e.issueImageList.push(t),e.storePhoto(e.issueImageList,e.photoType)):(e.completeImageList.push(t),e.storePhoto(e.completeImageList,e.photoType))}},!1),t&&s.readAsDataURL(t)):this.$dialog.alert({message:"上传图片大小不能超过16MB!",closeOnPopstate:!0}).then(function(){})},previewFileTwo:function(){var t=document.getElementById("demo2").files[0],e=this,s=new FileReader;t.size/1024/1024<16?(s.addEventListener("load",function(){var t=s.result,i=new Image;i.src=t,i.onload=function(){var t=Object(d.d)(i,void 0);e.clickIssue?(e.issueImageList.push(t),e.storePhoto(e.issueImageList,e.photoType)):(e.completeImageList.push(t),e.storePhoto(e.completeImageList,e.photoType))}},!1),t&&s.readAsDataURL(t)):e.$dialog.alert({message:"上传图片大小不能超过16MB!",closeOnPopstate:!0}).then(function(){})},storePhoto:function(t,e){var s=this,i=[];if(i=Object(d.e)(this.isCompleteRepairsWorkOrderPhotoList),this.isCompleteRepairsWorkOrderPhotoList.length>0){var o=this.isCompleteRepairsWorkOrderPhotoList.indexOf(this.isCompleteRepairsWorkOrderPhotoList.filter(function(t){return t.taskId==s.taskId})[0]);-1!==o?1===e?i[o].issuePhototList=t:2===e&&(i[o].completePhototList=t):1===e?i.push({issuePhototList:t,taskId:this.taskId}):2===e&&i.push({completePhototList:t,taskId:this.taskId})}else 1===e?i.push({issuePhototList:t,taskId:this.taskId}):2===e&&i.push({completePhototList:t,taskId:this.taskId});this.changeIsCompletePhotoList(i),Object(d.k)("completPhotoInfo",{photoInfo:i})},clearStoragePhoto:function(){var t=this;if(0!=this.isCompleteRepairsWorkOrderPhotoList.length){var e=this.isCompleteRepairsWorkOrderPhotoList.filter(function(e){return e.taskId!==t.taskId});this.changeIsCompletePhotoList(e),Object(d.k)("completPhotoInfo",{photoInfo:e})}},echoPhoto:function(){var t=this;if(this.historyIssueImageList=[],this.historyCompleteImageList=[],this.issueImageList=[],this.completeImageList=[],0!=this.isCompleteRepairsWorkOrderPhotoList.length){var e=this.isCompleteRepairsWorkOrderPhotoList.indexOf(this.isCompleteRepairsWorkOrderPhotoList.filter(function(e){return e.taskId==t.taskId})[0]);-1!==e&&(this.isCompleteRepairsWorkOrderPhotoList[e].issuePhototList&&(this.issueImageList=Object(d.e)(this.isCompleteRepairsWorkOrderPhotoList[e].issuePhototList)),this.isCompleteRepairsWorkOrderPhotoList[e].completePhototList&&(this.completeImageList=Object(d.e)(this.isCompleteRepairsWorkOrderPhotoList[e].completePhototList)))}},uploadPhoto:function(){var t=this;this.loadinText="上传中,请稍等···",this.overlayShow=!0,this.showLoadingHint=!0;var e=void 0,s={taskId:this.taskId,images:[]};if(s.images=[],this.issueImageList.length>0){e=1;var i=!0,a=!1,r=void 0;try{for(var n,h=o()(this.issueImageList);!(i=(n=h.next()).done);i=!0){var l=n.value;s.images.push({imgType:e,image:l})}}catch(t){a=!0,r=t}finally{try{!i&&h.return&&h.return()}finally{if(a)throw r}}}if(this.completeImageList.length>0){e=2;var c=!0,p=!1,u=void 0;try{for(var m,d=o()(this.completeImageList);!(c=(m=d.next()).done);c=!0){var v=m.value;s.images.push({imgType:e,image:v})}}catch(t){p=!0,u=t}finally{try{!c&&d.return&&d.return()}finally{if(p)throw u}}}Object(g.E)(s).then(function(e){t.showLoadingHint=!1,t.overlayShow=!1,e&&200==e.data.code?(t.$toast(""+e.data.msg),t.issueImageList.length>0&&(t.issueImageList=[]),t.completeImageList.length>0&&(t.completeImageList=[]),t.clearStorageMaterial(),t.clearPhotoList(),t.isFinishShow=!0):t.$toast(""+e.data.msg)}).catch(function(e){t.$dialog.alert({message:""+e.message,closeOnPopstate:!0}).then(function(){}),t.showLoadingHint=!1,t.overlayShow=!1})},clearPhotoList:function(){var t=this;if(0!=this.isCompleteRepairsWorkOrderPhotoList.length){var e=this.isCompleteRepairsWorkOrderPhotoList.indexOf(this.isCompleteRepairsWorkOrderPhotoList.filter(function(e){return e.taskId==t.taskId})[0]);if(-1!=e){var s=Object(d.e)(this.isCompleteRepairsWorkOrderPhotoList),i=[];s[e].completePhototList=i,s[e].issuePhototList=i,this.changeIsCompletePhotoList(s),Object(d.k)("completPhotoInfo",{photoInfo:s})}}},fillConsumable:function(){this.storageIsMaterial(),this.$router.push({path:"fillConsumable"}),this.changeTitleTxt({tit:"填写耗材"}),Object(d.k)("currentTitle","填写耗材")},isFinishSure:function(){var t=this;Object(g.c)({proId:this.proId,taskId:this.taskId}).then(function(e){e&&200==e.data.code?(t.$toast(""+e.data.msg),t.clearStoragePhoto(),t.$router.push({path:"repairsWorkOrder"}),t.changeTitleTxt({tit:"报修工单"}),Object(d.k)("currentTitle","报修工单")):t.$toast(""+e.data.msg)}).catch(function(e){t.$dialog.alert({message:""+e.message,closeOnPopstate:!0}).then(function(){})})},isFinishCancel:function(){this.$router.push({path:"repairsWorkOrder"}),this.changeTitleTxt({tit:"报修工单"}),Object(d.k)("currentTitle","报修工单")},completeTask:function(){if(4==this.repairsWorkOrderMsg.state)this.$router.push({path:"workOrderSignature"}),this.changeTitleTxt({tit:"工单完成签名"}),Object(d.k)("currentTitle","工单完成签名");else{if(0==this.issueImageList.length||0==this.completeImageList.length)return void this.$toast("请上传问题照片或完成照片");if(!this.isChangeConsumableShow)return void this.$toast("请填写耗材");this.uploadPhoto()}}})},f={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content-wrapper"},[s("van-overlay",{attrs:{show:t.overlayShow}}),t._v(" "),s("div",{staticClass:"worker-show"},[s("HeaderTop",{attrs:{title:t.navTopTitle}},[s("van-icon",{attrs:{slot:"left",name:"arrow-left"},on:{click:t.backTo},slot:"left"})],1),t._v(" "),s("div",{staticClass:"loading"},[s("loading",{attrs:{isShow:t.showLoadingHint,textContent:t.loadinText,textColor:"#2895ea"}})],1),t._v(" "),s("div",{staticClass:"content-top"},[s("p",{staticClass:"content-top-other"},[s("span",[t._v("工单编号")]),t._v(" "),s("span",[t._v("\n          "+t._s(t.oneRepairsMsg.taskNumber)+"\n        ")])]),t._v(" "),s("p",{staticClass:"content-top-other"},[s("span",[t._v("工单标题")]),t._v(" "),s("span",[t._v("\n          "+t._s(t.oneRepairsMsg.taskDesc)+"\n        ")])]),t._v(" "),s("p",{staticClass:"content-top-other"},[s("span",[t._v("工单类型")]),t._v(" "),s("span",[t._v("\n          "+t._s(t.oneRepairsMsg.typeName)+"\n        ")])]),t._v(" "),s("p",{staticClass:"content-top-other"},[s("span",[t._v("时间")]),t._v(" "),s("span",[t._v("\n          "+t._s(t.oneRepairsMsg.planStartTime)+"\n        ")])]),t._v(" "),s("p",{staticClass:"content-top-other"},[s("span",[t._v("参与人员")]),t._v(" "),t.oneRepairsMsg.present&&t.oneRepairsMsg.present.length>0?s("span",t._l(t.oneRepairsMsg.present,function(e,i){return s("b",{key:e+"-"+i},[t._v("\n            "+t._s(e.name)+"\n          ")])}),0):t._e(),t._v(" "),t.oneRepairsMsg.present&&0==t.oneRepairsMsg.present.length?s("span",[s("b",[t._v("\n            无\n          ")])]):t._e()]),t._v(" "),s("p",{staticClass:"content-top-other"},[s("span",[t._v("地点")]),t._v(" "),s("span",[t._v("\n          "+t._s(t.oneRepairsMsg.depName)+"\n        ")])]),t._v(" "),s("p",{staticClass:"content-top-name"},[s("span",[t._v("工单内容")]),t._v(" "),s("span",[t._v("\n          "+t._s(t.oneRepairsMsg.taskRemark?t.oneRepairsMsg.taskRemark:"无")+"\n        ")])])]),t._v(" "),4!=t.repairsWorkOrderMsg.state?s("div",{staticClass:"content-middle"},[s("p",{staticClass:"issue-photo"},[s("span",[t._v("问题拍照")]),t._v(" "),s("ul",{staticClass:"photo-list"},[t._l(t.issueImageList,function(e,i){return s("li",{directives:[{name:"show",rawName:"v-show",value:5!=t.repairsWorkOrderMsg.state,expression:"repairsWorkOrderMsg.state != 5"}],key:e+"-"+i},[s("img",{attrs:{width:"100",height:"130",src:e},on:{click:function(s){return t.enlargeIssueImgEvent(e)}}}),t._v(" "),s("van-icon",{attrs:{name:"cross"},on:{click:function(e){return t.issueDelete(i)}}})],1)}),t._v(" "),t._l(t.historyIssueImageList,function(e,i){return s("li",{directives:[{name:"show",rawName:"v-show",value:5==t.repairsWorkOrderMsg.state,expression:"repairsWorkOrderMsg.state == 5"}],key:e+"-"+i},[s("img",{attrs:{width:"100",height:"130",src:t.Base64.decode(e)},on:{click:function(s){t.enlargeIssueImgEvent(t.Base64.decode(e))}}})])})],2),t._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:5!==t.repairsWorkOrderMsg.state,expression:"repairsWorkOrderMsg.state !== 5"}],staticClass:"icon-wrapper",on:{click:t.issueClickEvent}},[s("van-icon",{attrs:{name:"plus"}})],1)]),t._v(" "),s("p",{staticClass:"complete-photo"},[s("span",[t._v("完成拍照")]),t._v(" "),s("ul",{staticClass:"photo-list"},[t._l(t.completeImageList,function(e,i){return s("li",{directives:[{name:"show",rawName:"v-show",value:5!=t.repairsWorkOrderMsg.state,expression:"repairsWorkOrderMsg.state != 5"}],key:e+"-"+i},[s("img",{attrs:{width:"100",height:"130",src:e},on:{click:function(s){return t.enlargeCompleteImgEvent(e)}}}),t._v(" "),s("van-icon",{attrs:{name:"cross"},on:{click:function(e){return t.completeDelete(i)}}})],1)}),t._v(" "),t._l(t.historyCompleteImageList,function(e,i){return s("li",{directives:[{name:"show",rawName:"v-show",value:5==t.repairsWorkOrderMsg.state,expression:"repairsWorkOrderMsg.state == 5"}],key:e+"-"+i},[s("img",{attrs:{width:"100",height:"130",src:t.Base64.decode(e)},on:{click:function(s){t.enlargeCompleteImgEvent(t.Base64.decode(e))}}})])})],2),t._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:5!==t.repairsWorkOrderMsg.state,expression:"repairsWorkOrderMsg.state !== 5"}],staticClass:"icon-wrapper",on:{click:t.completeClickEvent}},[s("van-icon",{attrs:{name:"plus"}})],1)])]):t._e(),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:5!==t.repairsWorkOrderMsg.state,expression:"repairsWorkOrderMsg.state !== 5"}],ref:"contentBottom",staticClass:"content-bottom"},[s("p",{directives:[{name:"show",rawName:"v-show",value:4!==t.repairsWorkOrderMsg.state&&t.isChangeConsumableShow,expression:"repairsWorkOrderMsg.state !== 4 && isChangeConsumableShow"}],staticClass:"back-home",on:{click:t.fillConsumable}},[t._v("修改耗材")]),t._v(" "),s("p",{directives:[{name:"show",rawName:"v-show",value:4!==t.repairsWorkOrderMsg.state&&!t.isChangeConsumableShow,expression:"repairsWorkOrderMsg.state !== 4 && !isChangeConsumableShow"}],staticClass:"back-home",on:{click:t.fillConsumable}},[t._v("填写耗材")]),t._v(" "),s("p",{staticClass:"quit-account",on:{click:t.completeTask}},[t._v(t._s(4==t.repairsWorkOrderMsg.state?"签字":"完成工单"))])]),t._v(" "),s("transition",{attrs:{name:"van-slide-up"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.photoBox,expression:"photoBox"}],staticClass:"choose-photo-box"},[s("div",{staticClass:"photo-graph"},[s("van-icon",{attrs:{name:"photograph"}}),t._v(" "),s("input",{attrs:{name:"uploadImg2",id:"demo2",type:"file",accept:"image/camera"},on:{change:t.previewFileTwo}}),t._v("拍照\n        ")],1),t._v(" "),s("div",{staticClass:"choose-photo"},[s("van-icon",{attrs:{name:"photo"}}),t._v(" "),s("input",{attrs:{name:"uploadImg1",id:"demo1",type:"file",accept:"image/album"},on:{change:t.previewFileOne}}),t._v("去相册选择\n        ")],1),t._v(" "),s("div",{staticClass:"photo-cancel",on:{click:t.photoCancel}},[t._v("取消")])])])],1),t._v(" "),s("van-dialog",{attrs:{width:"90%"},model:{value:t.enlargeImgShow,callback:function(e){t.enlargeImgShow=e},expression:"enlargeImgShow"}},[s("img",{attrs:{src:t.enlargeImgUrl}})]),t._v(" "),s("van-dialog",{attrs:{title:"确定完成?","show-cancel-button":""},on:{confirm:t.isFinishSure,cancel:t.isFinishCancel},model:{value:t.isFinishShow,callback:function(e){t.isFinishShow=e},expression:"isFinishShow"}})],1)},staticRenderFns:[]};var k=s("C7Lr")(v,f,!1,function(t){s("F/To")},"data-v-7ed40c53",null);e.default=k.exports}});