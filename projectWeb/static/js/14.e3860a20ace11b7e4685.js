webpackJsonp([14],{"/32D":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("HzJ8"),s=r.n(n),a=r("4YfN"),i=r.n(a),c=r("0eBz"),o=r("0DTB"),p=(r("sqAx"),r("NxGh"),r("IcnI"),r("yl8L")),d=r("SJI6"),u=r("fdFc"),f=r("EKaR"),h={name:"DepartmentWorkOrderDeatils",components:{HeaderTop:c.a,FooterBottom:o.a,VanFieldSelectPicker:p.a},data:function(){return{oneRepairsMsg:"",departmentId:"",departmentNo:""}},mounted:function(){var e=this;Object(u.b)()||(pushHistory(),this.gotoURL(function(){4==e.departmentServiceMsg.state?e.changeIsFreshDepartmentServicePage(!1):e.changeIsFreshDepartmentServicePage(!0),e.$router.push({path:"departmentService"}),e.changeTitleTxt({tit:"科室巡检"}),Object(u.k)("currentTitle","科室巡检")}));var t=this;window.scanQRcodeCallback=function(e){t.scanQRcodeCallback(e)},this.getOneDepartmentService()},watch:{},computed:i()({},Object(d.mapGetters)(["navTopTitle","departmentServiceMsg","userInfo","isCurrentDepartmentServiceVerifySweepCode","completeDepartmentServiceOfficeInfo","isDepartmentServiceVerifySweepCode"]),{userName:function(){return this.userInfo.userName},userTypeId:function(){return this.userInfo.extendData.user_type_id},proId:function(){return this.userInfo.extendData.proId},proName:function(){return this.userInfo.extendData.proName},workerId:function(){return this.userInfo.extendData.userId},name:function(){return this.userInfo.name},taskId:function(){return this.departmentServiceMsg.id}}),methods:i()({},Object(d.mapMutations)(["changeTitleTxt","changeIsFreshDepartmentServicePage","changeIsDepartmentServiceVerifySweepCode","changeIsCurrentDepartmentServiceVerifySweepCode","changeDepartmentServiceOfficeId","changeIsSingleDepartmentSignature"]),{backTo:function(){4==this.departmentServiceMsg.state?this.changeIsFreshDepartmentServicePage(!1):this.changeIsFreshDepartmentServicePage(!0),this.$router.push({path:"departmentService"}),this.changeTitleTxt({tit:"科室巡检"}),Object(u.k)("currentTitle","科室巡检")},getOneDepartmentService:function(){var e=this;Object(f.p)(this.taskId).then(function(t){if(t&&200==t.data.code){var r=t.data.data;r.spaces=t.data.data.spaces;var n=!0,a=!1,i=void 0;try{for(var c,o=s()(r.spaces);!(n=(c=o.next()).done);n=!0){c.value.checked=!1}}catch(e){a=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(a)throw i}}if(e.oneRepairsMsg=r,e.completeDepartmentServiceOfficeInfo.length>0)for(var p=0,d=e.completeDepartmentServiceOfficeInfo.length;p<d;p++)if(e.oneRepairsMsg.id==e.completeDepartmentServiceOfficeInfo[p].taskId&&e.completeDepartmentServiceOfficeInfo[p].officeList.length>0)for(var u=0,f=e.completeDepartmentServiceOfficeInfo[p].officeList.length;u<f;u++)if(e.oneRepairsMsg.spaces.length>0)for(var h=0,m=e.oneRepairsMsg.spaces.length;h<m;h++)e.oneRepairsMsg.spaces[h].depNo==e.completeDepartmentServiceOfficeInfo[p].officeList[u]&&(e.oneRepairsMsg.spaces[h].checked=!0)}}).catch(function(t){e.$dialog.alert({message:""+t.message,closeOnPopstate:!0}).then(function(){})})},fillConsumable:function(){this.oneRepairsMsg.spaces.every(function(e){return 1==e.checked})?this.$toast("该任务下所有科室都已完成检修,不能执行该操作"):3!=this.departmentServiceMsg.state?window.android.scanQRcode():this.$toast("该任务状态为待签字,不能执行该操作")},juddgeCurrentDepartment:function(e){var t=this;Object(f.F)(e).then(function(r){r&&200==r.data.code?(t.storeDepartmentNumber(e.depNo),t.storeCurrentDepartmentNumber(e.depId),t.changeDepartmentServiceOfficeId(e.depNo),Object(u.k)("departmentServiceId",e.depNo),t.$router.push({path:"departmentServiceBill"}),t.changeTitleTxt({tit:"科室巡检单"}),Object(u.k)("currentTitle","科室巡检单")):t.$toast(""+r.data.msg)}).catch(function(e){t.$dialog.alert({message:""+e,closeOnPopstate:!0}).then(function(){})})},scanQRcodeCallback:function(e){var t=this;if(e){var r=e.split("|");if(r.length>0){if(this.departmentId=r[0],this.departmentNo=r[1],this.oneRepairsMsg.spaces.filter(function(e){return 1==e.checked}).some(function(e){return e.depNo==t.departmentNo}))return void this.$toast("当前扫码科室巡检已完成,禁止此操作");this.juddgeCurrentDepartment({id:this.taskId,depNo:this.departmentNo,depId:this.departmentId,workerId:this.workerId})}}else this.$dialog.alert({message:"当前没有扫描到任何信息,请重新扫描"}).then(function(){t.fillConsumable()})},storeDepartmentNumber:function(e){var t=this,r=[],n=[];if(r=Object(u.e)(this.isDepartmentServiceVerifySweepCode),this.isDepartmentServiceVerifySweepCode.length>0){var s=this.isDepartmentServiceVerifySweepCode.indexOf(this.isDepartmentServiceVerifySweepCode.filter(function(e){return e.taskId==t.taskId})[0]);-1!=s?((n=r[s].officeList).push(e),r[s].officeList=Object(u.j)(n)):(n.push(e),r.push({officeList:Object(u.j)(n),taskId:this.taskId}))}else n.push(e),r.push({officeList:Object(u.j)(n),taskId:this.taskId});this.changeIsDepartmentServiceVerifySweepCode(r),Object(u.k)("isDepartmentServiceVerifySweepCode",{sweepCodeInfo:r})},storeCurrentDepartmentNumber:function(e){var t=this,r=[];if((r=Object(u.e)(this.isCurrentDepartmentServiceVerifySweepCode)).length>0){var n=this.isCurrentDepartmentServiceVerifySweepCode.indexOf(this.isCurrentDepartmentServiceVerifySweepCode.filter(function(e){return e.taskId==t.taskId})[0]);-1!=n?r[n].number=e:r.push({number:e,taskId:this.taskId})}else r.push({number:e,taskId:this.taskId});this.changeIsCurrentDepartmentServiceVerifySweepCode(r),Object(u.k)("isCurrentDepartmentServiceVerifySweepCode",{number:r})},signatureClick:function(){this.changeIsSingleDepartmentSignature(!1),this.$router.push({path:"departmentServiceSignature"}),this.changeTitleTxt({tit:"巡检签名"}),Object(u.k)("currentTitle","巡检签名")},completeTask:function(){var e=this;Object(f.D)(this.proId,this.taskId).then(function(t){if(t&&200==t.data.code){var r=e.isDepartmentServiceVerifySweepCode.filter(function(t){return t.taskId!==e.taskId});e.changeIsDepartmentServiceVerifySweepCode(r),Object(u.k)("isDepartmentServiceVerifySweepCode",{sweepCodeInfo:r});var n=e.isCurrentDepartmentServiceVerifySweepCode.filter(function(t){return t.taskId!==e.taskId});e.changeIsCurrentDepartmentServiceVerifySweepCode(n),Object(u.k)("isCurrentDepartmentServiceVerifySweepCode",{number:n}),e.$router.push({path:"departmentService"}),e.changeTitleTxt({tit:"科室巡检"}),Object(u.k)("currentTitle","科室巡检")}else e.$toast(""+t.data.msg)}).catch(function(t){e.$dialog.alert({message:""+t.message}).then(function(){})})}})},m={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"content-wrapper"},[r("div",{staticClass:"worker-show"},[r("HeaderTop",{attrs:{title:e.navTopTitle}},[r("van-icon",{attrs:{slot:"left",name:"arrow-left"},on:{click:e.backTo},slot:"left"})],1),e._v(" "),r("div",{staticClass:"content-top"},[r("p",{staticClass:"content-top-other"},[r("span",[e._v("巡检编号")]),e._v(" "),r("span",[e._v("\n          "+e._s(e.oneRepairsMsg.taskNumber)+"\n        ")])]),e._v(" "),r("p",{staticClass:"content-top-other"},[r("span",[e._v("巡检名称")]),e._v(" "),r("span",[e._v("\n          "+e._s(e.oneRepairsMsg.taskName)+"\n        ")])]),e._v(" "),r("p",{staticClass:"content-top-other"},[r("span",[e._v("当前次数")]),e._v(" "),r("span",[e._v("\n          "+e._s(e.oneRepairsMsg.currentTimes)+"\n        ")])]),e._v(" "),r("p",{staticClass:"content-top-other"},[r("span",[e._v("时间")]),e._v(" "),r("span",[e._v("\n          "+e._s(e.oneRepairsMsg.startTime)+"\n        ")])])]),e._v(" "),r("div",{staticClass:"content-middle"},[r("p",[e._v("巡检地点")]),e._v(" "),r("ul",{directives:[{name:"show",rawName:"v-show",value:!!e.oneRepairsMsg.spaces&&e.oneRepairsMsg.spaces.length>0,expression:"oneRepairsMsg.spaces ? oneRepairsMsg.spaces.length > 0 : false"}]},e._l(e.oneRepairsMsg.spaces,function(t,n){return r("li",{key:t+"-"+n,class:{listStyle:t.checked}},[e._v(e._s(t.depName))])}),0)]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:4!==e.departmentServiceMsg.state,expression:"departmentServiceMsg.state !== 4"}],staticClass:"content-bottom"},[r("p",{staticClass:"back-home",on:{click:e.fillConsumable}},[e._v("扫一扫")]),e._v(" "),r("p",{directives:[{name:"show",rawName:"v-show",value:3!=e.departmentServiceMsg.state,expression:"departmentServiceMsg.state != 3"}],staticClass:"quit-account",on:{click:e.completeTask}},[e._v("完成巡检")]),e._v(" "),r("p",{directives:[{name:"show",rawName:"v-show",value:3==e.departmentServiceMsg.state,expression:"departmentServiceMsg.state == 3"}],staticClass:"quit-account",on:{click:e.signatureClick}},[e._v("签字")])])],1)])},staticRenderFns:[]};var v=r("C7Lr")(h,m,!1,function(e){r("7Ado")},"data-v-4c01ac70",null);t.default=v.exports},"7Ado":function(e,t){}});