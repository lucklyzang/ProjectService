webpackJsonp([9],{"8qa+":function(t,s){},M1aC:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=e("HzJ8"),n=e.n(a),i=e("4YfN"),r=e.n(i),o=e("0eBz"),c=e("0DTB"),l=e("sqAx"),h=e("NxGh"),p=e("SJI6"),u=e("IcnI"),v=e("fdFc"),d=e("EKaR"),m={name:"DepartmentService",data:function(){return{currentIndex:0,tabTitleList:["待办任务","已完成"],isRefresh:!1,noDataShow:!1,showLoadingHint:!1,taskMessageList:[],taskCompleteMessageList:[]}},components:{HeaderTop:o.a,NoData:l.a,Loading:h.a,FooterBottom:c.a},computed:r()({},Object(p.mapGetters)(["navTopTitle","userInfo","catch_components","isFreshDepartmentServicePage"]),{proId:function(){return this.userInfo.extendData.proId},workerId:function(){return JSON.parse(Object(v.h)("userInfo")).extendData.userId}}),watch:{},beforeRouteEnter:function(t,s,e){var a=u.a.state.catchComponent.catch_components;-1===a.indexOf("DepartmentService")&&a.push("DepartmentService"),e()},beforeRouteLeave:function(t,s,e){var a=this.catch_components;"departmentWorkOrderDeatils"!==t.name&&(a.indexOf("DepartmentService")>-1&&this.changeCatchComponent([]));e()},mounted:function(){var t=this;if(!Object(v.b)()){pushHistory(),this.gotoURL(function(){pushHistory(),t.$router.push({path:"home"}),t.changeTitleTxt({tit:"工程管理系统"}),Object(v.k)("currentTitle","工程管理系统")})}this.isFreshDepartmentServicePage&&this.getDepartmentList({proId:this.proId,workerId:this.workerId,state:-1,startDate:"",endDate:""},0)},activated:function(){var t=this;if(!Object(v.b)()){pushHistory(),this.gotoURL(function(){pushHistory(),t.$router.push({path:"home"}),t.changeTitleTxt({tit:"工程管理系统"}),Object(v.k)("currentTitle","工程管理系统")})}this.isFreshDepartmentServicePage&&this.getDepartmentList({proId:this.proId,workerId:this.workerId,state:-1,startDate:"",endDate:""},0)},methods:r()({},Object(p.mapMutations)(["changeTitleTxt","changeCatchComponent","changeDepartmentServiceMsg"]),{stateTransfer:function(t){switch(t){case 0:return"未分配";case 1:return"未开始";case 2:return"待完成";case 3:return"待签字";case 4:return"已完成"}},calculateCount:function(t){return Object(v.f)(t).length},calculateCountUnfinish:function(t,s,e){return Object(v.f)(s).length-Object(v.f)(e).length},liClickEvent:function(t,s){this.currentIndex=s,0==s?this.getDepartmentList({proId:this.proId,workerId:this.workerId,state:-1,startDate:"",endDate:""},s):this.getDepartmentList({proId:this.proId,workerId:this.workerId,state:-2,startDate:"",endDate:""},s)},onRefresh:function(){this.getDepartmentList({proId:this.proId,workerId:this.workerId,state:0==this.currentIndex?-1:-2,startDate:"",endDate:""},this.currentIndex)},getDepartmentList:function(t,s){var e=this;this.noDataShow=!1,this.showLoadingHint=!0,Object(d.m)(t).then(function(t){if(e.showLoadingHint=!1,e.taskMessageList=[],e.taskCompleteMessageList=[],t&&200==t.data.code)if(e.isRefresh=!1,t.data.data.length>0){e.noDataShow=!1;var a=!0,i=!1,r=void 0;try{for(var o,c=n()(t.data.data);!(a=(o=c.next()).done);a=!0){var l=o.value;0==s?e.taskMessageList.push({taskNumber:l.taskNumber,taskName:l.taskName,startTime:l.startTime,state:l.state,currentTimes:l.currentTimes,id:l.id,isMe:l.isMe,spaces:l.spaces,hasSpaces:l.hasSpaces}):e.taskCompleteMessageList.push({taskNumber:l.taskNumber,taskName:l.taskName,startTime:l.startTime,state:l.state,currentTimes:l.currentTimes,id:l.id,isMe:l.isMe,spaces:l.spaces,hasSpaces:l.hasSpaces})}}catch(t){i=!0,r=t}finally{try{!a&&c.return&&c.return()}finally{if(i)throw r}}}else e.noDataShow=!0}).catch(function(t){e.$dialog.alert({message:""+t.message,closeOnPopstate:!0}).then(function(){}),e.showLoadingHint=!1})},taskView:function(t){this.changeDepartmentServiceMsg(t),Object(v.k)("departmentServiceMsg",t),this.$router.push({path:"departmentWorkOrderDeatils"}),this.changeTitleTxt({tit:"工单详情"}),Object(v.k)("currentTitle","工程详情")},backTo:function(){this.$router.push({path:"home"}),this.changeTitleTxt({tit:"工程管理系统"}),Object(v.k)("currentTitle","工程管理系统")}})},f={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content-wrapper"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.noDataShow,expression:"noDataShow"}],staticClass:"no-data"},[e("NoData")],1),t._v(" "),e("div",{staticClass:"loading"},[e("loading",{attrs:{isShow:t.showLoadingHint,textContent:"加载中,请稍候····",textColor:"#2db8f9"}})],1),t._v(" "),e("HeaderTop",{attrs:{title:t.navTopTitle}},[e("van-icon",{attrs:{slot:"left",name:"arrow-left"},on:{click:t.backTo},slot:"left"})],1),t._v(" "),e("div",{staticClass:"content-top"},[e("ul",{staticClass:"tab-title"},t._l(t.tabTitleList,function(s,a){return e("li",{key:""+a,class:{liStyle:t.currentIndex==a},on:{click:function(e){return t.liClickEvent(s,a)}}},[t._v(t._s(s))])}),0)]),t._v(" "),e("div",{staticClass:"content-bottom"},[e("van-pull-refresh",{attrs:{"success-text":"刷新成功"},on:{refresh:t.onRefresh},model:{value:t.isRefresh,callback:function(s){t.isRefresh=s},expression:"isRefresh"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:0==t.currentIndex,expression:"currentIndex == 0"}],staticClass:"content-list-action-task-wrapper"},t._l(t.taskMessageList,function(s,a){return e("div",{key:a+"-"+s,staticClass:"content-list-action-task-item"},[e("span",{staticClass:"status-box",class:{statusWaitFinish:2==s.state,statusWaitSignature:3==s.state}},[t._v(t._s(t.stateTransfer(s.state)))]),t._v(" "),e("span",{staticClass:"task-date"},[t._v(t._s(s.startTime))]),t._v(" "),e("p",{staticClass:"task-btn"},[e("span",{staticClass:"view",class:{viewStyle:1==s.state},on:{click:function(e){return t.taskView(s)}}},[t._v("查看任务")])]),t._v(" "),e("p",{staticClass:"work-order-number"},[e("span",{staticClass:"tit"},[t._v("巡检单号:")]),t._v(" "),e("span",{staticClass:"name "},[t._v(t._s(s.taskNumber))])]),t._v(" "),e("p",{staticClass:"work-info-other"},[e("span",{staticClass:"tit"},[t._v("巡检:")]),t._v(" "),e("span",{staticClass:"name"},[t._v(t._s(s.taskName))])]),t._v(" "),e("p",{staticClass:"work-info-other"},[e("span",{staticClass:"tit"},[t._v("当前次数:")]),t._v(" "),e("span",{staticClass:"name"},[t._v(t._s(s.currentTimes))])]),t._v(" "),e("p",{staticClass:"work-info-other work-info-other-row"},[e("span",{staticClass:"tit"},[t._v("已完成点位:")]),t._v(" "),e("span",{staticClass:"name"},[t._v(t._s(s.hasSpaces?t.calculateCount(s.hasSpaces):0))])]),t._v(" "),e("p",{staticClass:"work-info-other work-info-other-row"},[e("span",{staticClass:"tit"},[t._v("未完成点位:")]),t._v(" "),e("span",{staticClass:"name"},[t._v(t._s(s.hasSpaces?t.calculateCountUnfinish(s,s.spaces,s.hasSpaces):t.calculateCount(s.spaces)))])])])}),0),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:1==t.currentIndex,expression:"currentIndex == 1"}],staticClass:"content-list-action-task-wrapper content-list-complete-task-wrapper"},t._l(t.taskCompleteMessageList,function(s,a){return e("div",{key:a+"-"+s,staticClass:"content-list-action-task-item"},[e("span",{staticClass:"status-box"},[t._v(t._s(t.stateTransfer(s.state)))]),t._v(" "),e("span",{staticClass:"task-date"},[t._v(t._s(s.startTime))]),t._v(" "),e("p",{staticClass:"task-btn"},[e("span",{staticClass:"view",on:{click:function(e){return t.taskView(s)}}},[t._v("查看任务")])]),t._v(" "),e("p",{staticClass:"work-order-number"},[e("span",{staticClass:"tit"},[t._v("巡检单号:")]),t._v(" "),e("span",{staticClass:"name"},[t._v(t._s(s.taskNumber))])]),t._v(" "),e("p",{staticClass:"work-info-other"},[e("span",{staticClass:"tit"},[t._v("巡检:")]),t._v(" "),e("span",{staticClass:"name"},[t._v(t._s(s.taskName))])]),t._v(" "),e("p",{staticClass:"work-info-other"},[e("span",{staticClass:"tit"},[t._v("当前次数:")]),t._v(" "),e("span",{staticClass:"name"},[t._v(t._s(s.currentTimes))])]),t._v(" "),e("p",{staticClass:"work-info-other work-info-other-row"},[e("span",{staticClass:"tit"},[t._v("已完成点位:")]),t._v(" "),e("span",{staticClass:"name"},[t._v(t._s(s.hasSpaces?t.calculateCount(s.hasSpaces):0))])]),t._v(" "),e("p",{staticClass:"work-info-other work-info-other-row"},[e("span",{staticClass:"tit"},[t._v("未完成点位:")]),t._v(" "),e("span",{staticClass:"name"},[t._v(t._s(s.hasSpaces?t.calculateCountUnfinish(s,s.spaces,s.hasSpaces):t.calculateCount(s.spaces)))])])])}),0)])],1),t._v(" "),e("van-dialog",{attrs:{title:"请选择退回原因","show-cancel-button":"",width:"92%"},on:{confirm:t.toolSure,cancel:t.toolCancel},model:{value:t.toolShow,callback:function(s){t.toolShow=s},expression:"toolShow"}},[e("div",{staticClass:"tool-name-list"},[e("div",{staticClass:"tool-name-list-title-innner"},[t._v("退回原因:")]),t._v(" "),e("div",{staticClass:"tool-name-list-content"},t._l(t.vehicleOperationList,function(s,a){return e("span",{key:s+"-"+a,class:{spanStyle:t.toolIndex===a},on:{click:function(e){return t.toolCheck(s,a)}}},[t._v("\n              "+t._s(s.text)+"\n            ")])}),0)])])],1)},staticRenderFns:[]};var _=e("C7Lr")(m,f,!1,function(t){e("8qa+")},"data-v-6d149d33",null);s.default=_.exports}});